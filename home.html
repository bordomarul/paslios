<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Paslios - Ana Sayfa">
    <link href="output.css" rel="stylesheet">
    <link href="css/responsive.css" rel="stylesheet">
    <title>Paslios - Ana Sayfa</title>
    
    <!-- Authentication Guard -->
    <script src="js/auth-guard.js"></script>
    
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f9fafb;
        min-height: 100vh;
        padding-bottom: 80px;
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
      }
      
      .header {
        background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
        padding: 3rem 1rem 2rem 1rem;
        width: 100vw;
        margin-left: calc(-50vw + 50%);
      }
      
      .header-container {
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
      }
      
      .header-container {
        width: 100%;
      }
      
      .nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 2rem;
      }
      
      .nav-left {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      
      .logo {
        color: white;
        font-size: 1.5rem;
        font-weight: bold;
      }
      
      .user-avatar {
        width: 2.5rem;
        height: 2.5rem;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #059669;
      }
      
      .nav-right {
        display: flex;
        gap: 0.5rem;
      }
      
      .nav-btn {
        width: 2.5rem;
        height: 2.5rem;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .nav-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      
      .welcome-text {
        color: white;
        margin-bottom: 1.5rem;
      }
      
      .welcome-title {
        font-size: 1.75rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      
      .welcome-subtitle {
        color: rgba(255, 255, 255, 0.8);
        font-size: 1rem;
      }
      
      .quick-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
      }
      
      .action-btn {
        background: rgba(255, 255, 255, 0.9);
        border-radius: 16px;
        padding: 1rem;
        text-decoration: none;
        color: #1f2937;
        transition: all 0.2s;
        backdrop-filter: blur(10px);
        text-align: center;
      }
      
      .action-btn:hover {
        background: white;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }
      
      .action-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
        display: block;
      }
      
      .action-title {
        font-weight: 600;
        margin-bottom: 0.25rem;
      }
      
      .action-desc {
        font-size: 0.875rem;
        color: #6b7280;
      }
      
      .main-content {
        flex: 1;
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
        padding: 1.5rem 1rem;
      }
      
      .section {
        margin-bottom: 2rem;
      }
      
      .section-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }
      
      .section-title {
        color: #1f2937;
        font-size: 1.125rem;
        font-weight: bold;
      }
      
      .section-link {
        color: #10b981;
        font-size: 0.875rem;
        font-weight: 600;
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .section-link:hover {
        color: #059669;
      }
      
      .match-card {
        background: white;
        border-radius: 16px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border: 1px solid #f3f4f6;
        transition: all 0.2s;
      }
      
      .match-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      }
      
      .match-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
      }
      
      .match-time {
        background: #10b981;
        color: white;
        font-size: 0.75rem;
        font-weight: 600;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
      }
      
      .match-status {
        color: #6b7280;
        font-size: 0.75rem;
        font-weight: 500;
        background: #f3f4f6;
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
      }
      
      .match-title {
        color: #1f2937;
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }
      
      .match-location {
        color: #6b7280;
        font-size: 0.875rem;
        margin-bottom: 0.5rem;
      }
      
      .match-players {
        color: #6b7280;
        font-size: 0.875rem;
      }
      
      .post-card {
        background: white;
        border-radius: 16px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        border: 1px solid #f3f4f6;
      }
      
      .post-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
      }
      
      .post-avatar {
        width: 2.5rem;
        height: 2.5rem;
        background: #e5e7eb;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.875rem;
        color: #6b7280;
      }
      
      .post-info {
        flex: 1;
      }
      
      .post-author {
        color: #1f2937;
        font-weight: 600;
        font-size: 0.875rem;
      }
      
      .post-time {
        color: #6b7280;
        font-size: 0.75rem;
      }
      
      .post-content {
        color: #1f2937;
        font-size: 0.9375rem;
        line-height: 1.5;
        margin-bottom: 0.75rem;
      }
      
      .post-actions {
        display: flex;
        align-items: center;
        gap: 1rem;
        padding-top: 0.75rem;
        border-top: 1px solid #f3f4f6;
      }
      
      .post-likes, .post-comments, .post-shares {
        color: #6b7280;
        font-size: 0.75rem;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .post-likes:hover, .post-comments:hover, .post-shares:hover {
        color: #3b82f6;
      }

      .post-likes.liked {
        color: #ef4444 !important;
      }

      .post-author {
        cursor: pointer;
        transition: all 0.2s;
      }

      .post-author:hover {
        color: #10b981;
        text-decoration: underline;
      }

      .match-status-waiting {
        background: #fef3c7;
        color: #92400e;
      }

      .match-status-full {
        background: #fecaca;
        color: #991b1b;
      }

      .match-status-confirmed {
        background: #d1fae5;
        color: #065f46;
      }
      
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 1px solid #f3f4f6;
        padding: 1rem;
        box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.05);
        z-index: 1000;
      }
      
      .nav-items {
        display: flex;
        justify-content: space-around;
        max-width: 400px;
        margin: 0 auto;
      }
      
      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .nav-item.active {
        color: #10b981;
      }
      
      .nav-item:not(.active) {
        color: #6b7280;
      }
      
      .floating-btn {
        position: fixed;
        bottom: 5rem;
        right: 1rem;
        width: 3.5rem;
        height: 3.5rem;
        background: linear-gradient(135deg, #10b981, #059669);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .floating-btn:hover {
        transform: scale(1.1);
      }
      
      .nav-item:hover {
        color: #10b981;
      }
      
      .nav-item span:first-child {
        font-size: 1.25rem;
        margin-bottom: 0.25rem;
      }
      
      .nav-item span:last-child {
        font-size: 0.75rem;
        font-weight: 500;
      }
      
      /* Toast Notifications */
      .toast {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #10b981;
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
        transition: all 0.3s ease;
        max-width: 350px;
        text-align: center;
      }
      
      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      
      .toast.success {
        background: #10b981;
      }
      
      .toast.error {
        background: #ef4444;
      }
      
      .toast.info {
        background: #3b82f6;
      }
      
      /* Comment Modal */
      .comment-modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      
      .comment-modal-content {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        max-width: 350px;
        margin: 1rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        transform: scale(0.9);
        transition: transform 0.2s ease;
      }
      
      .comment-modal.show .comment-modal-content {
        transform: scale(1);
      }
      
      .comment-modal-header {
        display: flex;
        align-items: center;
        margin-bottom: 1rem;
      }
      
      .comment-modal-avatar {
        width: 2.5rem;
        height: 2.5rem;
        border-radius: 50%;
        background: #10b981;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        margin-right: 0.75rem;
      }
      
      .comment-modal-info h3 {
        font-size: 1rem;
        font-weight: 600;
        color: #1f2937;
        margin: 0;
      }
      
      .comment-modal-info p {
        font-size: 0.875rem;
        color: #6b7280;
        margin: 0;
      }
      
      .comment-textarea {
        width: 100%;
        min-height: 80px;
        padding: 0.75rem;
        border: 2px solid #e5e7eb;
        border-radius: 8px;
        font-size: 0.875rem;
        resize: vertical;
        font-family: inherit;
        margin-bottom: 1rem;
      }
      
      .comment-textarea:focus {
        outline: none;
        border-color: #10b981;
      }
      
      .comment-actions {
        display: flex;
        gap: 0.75rem;
        justify-content: flex-end;
      }
      
      .comment-btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.875rem;
      }
      
      .comment-btn-cancel {
        background: #f3f4f6;
        color: #6b7280;
      }
      
      .comment-btn-cancel:hover {
        background: #e5e7eb;
      }
      
      .comment-btn-submit {
        background: #10b981;
        color: white;
      }
      
      .comment-btn-submit:hover {
        background: #059669;
        transform: translateY(-1px);
      }
      
      .comment-btn-submit:disabled {
        background: #d1d5db;
        cursor: not-allowed;
        transform: none;
      }
      
      /* Yorum görüntüleme stilleri */
      .post-comments-section {
        margin-top: 1rem;
        border-top: 1px solid #e5e7eb;
        padding-top: 1rem;
      }
      
      .comments-header {
        font-weight: 600;
        color: #374151;
        margin-bottom: 0.75rem;
        font-size: 0.9rem;
      }
      
      .comment-item {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
      }
      
      .comment-avatar {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: #f3f4f6;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 14px;
        flex-shrink: 0;
      }
      
      .comment-content {
        flex: 1;
        min-width: 0;
      }
      
      .comment-header {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 0.25rem;
      }
      
      .comment-author {
        font-weight: 600;
        color: #374151;
        font-size: 0.875rem;
      }
      
      .comment-time {
        color: #6b7280;
        font-size: 0.75rem;
      }
      
      .comment-text {
        color: #374151;
        font-size: 0.875rem;
        line-height: 1.4;
        word-wrap: break-word;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-container">
        <!-- Navigation -->
        <div class="nav">
          <div class="nav-left">
            <div class="logo">⚽ Paslios</div>
            <div class="user-avatar">AY</div>
          </div>
          <div class="nav-right">
            <a href="search.html" class="nav-btn">
              <span style="color: white; font-size: 1rem;">🔍</span>
            </a>
            <a href="notifications.html" class="nav-btn">
              <span style="color: white; font-size: 1rem;">🔔</span>
            </a>
          </div>
        </div>

        <!-- Welcome Section -->
        <div class="welcome-text">
          <div class="welcome-title">Selam Ahmet! 👋</div>
          <div class="welcome-subtitle">Bugün hangi maça katılacaksın?</div>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
          <a href="matches.html" class="action-btn">
            <span class="action-icon">⚽</span>
            <div class="action-title">Maç Bul</div>
            <div class="action-desc">Yakındaki maçları keşfet</div>
          </a>
          <a href="booking.html" class="action-btn">
            <span class="action-icon">🏟️</span>
            <div class="action-title">Saha Reserve Et</div>
            <div class="action-desc">Saha bul ve rezerve et</div>
          </a>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Upcoming Matches -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">Yaklaşan Maçlar</div>
          <a href="matches.html" class="section-link">Tümünü Gör</a>
        </div>

        <div id="upcomingMatches">
          <!-- Dinamik maç listesi buraya yüklenecek -->
        </div>
      </div>

      <!-- Social Feed -->
      <div class="section">
        <div class="section-header">
          <div class="section-title">Son Aktiviteler</div>
          <a href="profile.html" class="section-link">Profili Gör</a>
        </div>

        <div id="socialFeed">
          <!-- Dinamik sosyal feed buraya yüklenecek -->
        </div>
      </div>
    </div>

    <!-- Floating Action Button -->
    <a href="create-post.html" class="floating-btn">
      <span style="color: white; font-size: 1.5rem;">+</span>
    </a>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <div class="nav-items">
        <a href="home.html" class="nav-item active">
          <span>🏠</span>
          <span>Ana Sayfa</span>
        </a>
        <a href="matches.html" class="nav-item">
          <span>⚽</span>
          <span>Maçlar</span>
        </a>
        <a href="messages.html" class="nav-item">
          <span>💌</span>
          <span>Mesajlar</span>
        </a>
        <a href="profile.html" class="nav-item">
          <span>👤</span>
          <span>Profil</span>
        </a>
      </div>
    </div>

    <script>
    </script>

    <!-- Comment Modal -->
    <div id="commentModal" class="comment-modal">
      <div class="comment-modal-content">
        <div class="comment-modal-header">
          <div class="comment-modal-avatar" id="commentAuthorAvatar"></div>
          <div class="comment-modal-info">
            <h3 id="commentAuthorName">Kullanıcı Adı</h3>
            <p>Gönderisine yorum yap</p>
          </div>
        </div>
        <textarea 
          id="commentText" 
          class="comment-textarea" 
          placeholder="Yorumunuzu yazın..."
          maxlength="500"
        ></textarea>
        <div class="comment-actions">
          <button class="comment-btn comment-btn-cancel" onclick="closeCommentModal()">İptal</button>
          <button class="comment-btn comment-btn-submit" id="submitComment" onclick="submitComment()">Yorum Yap</button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Data Management Script -->
    <script src="js/data.js"></script>
    <script src="js/toast.js"></script>
    <script src="js/mobile-ux.js"></script>
    <script src="js/ux-enhancer.js"></script>
    <script>
      // Sayfa yüklendiğinde oturum kontrolü
      document.addEventListener('DOMContentLoaded', function() {
        console.log('Home sayfa yüklendi');
        console.log('window.pasliosData:', window.pasliosData);
        console.log('window.PasliosData:', window.PasliosData);
        
        // pasliosData yüklenene kadar bekle
        if (typeof pasliosData === 'undefined') {
          console.error('pasliosData yüklenmedi! Script yükleme sorunu var.');
          setTimeout(() => {
            if (typeof pasliosData !== 'undefined') {
              console.log('pasliosData gecikmeli olarak yüklendi');
              initializePage();
            } else {
              console.error('pasliosData hala yüklenmedi!');
            }
          }, 1000);
          return;
        }
        
        initializePage();
      });
      
      function initializePage() {
        console.log('initializePage çağırıldı');
        console.log('pasliosData:', window.pasliosData);
        console.log('isAuthenticated:', pasliosData.isAuthenticated());
        console.log('currentUser:', pasliosData.getCurrentUser());
        
        if (!pasliosData.isAuthenticated()) {
          console.log('Kullanıcı giriş yapmamış, index.html\'e yönlendiriliyor');
          window.location.href = 'index.html';
          return;
        }
        
        console.log('Kullanıcı giriş yapmış, sayfa yükleniyor...');
        loadUserInfo();
        // loadUpcomingMatches(); // Geçici olarak devre dışı
        loadSocialFeed();
        setupEventListeners();
      }

      function loadUserInfo() {
        // localStorage'dan gerçek kullanıcı verilerini oku
        const currentUserData = localStorage.getItem('currentUser');
        if (currentUserData) {
          const currentUser = JSON.parse(currentUserData);
          
          // Header'daki kullanıcı bilgilerini güncelle
          const userAvatarElements = document.querySelectorAll('.user-avatar');
          userAvatarElements.forEach(element => {
            // İlk harfleri avatar olarak kullan
            const nameParts = currentUser.name.split(' ');
            const initials = nameParts.length > 1 ? 
              nameParts[0][0] + nameParts[1][0] : 
              nameParts[0][0] + nameParts[0][1] || nameParts[0][0];
            element.textContent = initials.toUpperCase();
          });
          
          // Hoş geldin mesajını güncelle
          const welcomeTitle = document.querySelector('.welcome-title');
          if (welcomeTitle) {
            const firstName = currentUser.name.split(' ')[0];
            welcomeTitle.textContent = `Selam ${firstName}! 👋`;
          }
          
          // Kullanıcı istatistiklerini güncelle
          updateUserStats(currentUser);
        } else {
          // Giriş yapılmamışsa login sayfasına yönlendir
          window.location.href = 'index.html';
        }
      }

      function updateUserStats(currentUser) {
        // Kullanıcı istatistiklerini sayfada göster
        const statElements = {
          matchesPlayed: document.querySelector('[data-stat="matches-played"]'),
          matchesWon: document.querySelector('[data-stat="matches-won"]'),
          goals: document.querySelector('[data-stat="goals"]'),
          assists: document.querySelector('[data-stat="assists"]'),
          rating: document.querySelector('[data-stat="rating"]'),
          totalPoints: document.querySelector('[data-stat="total-points"]'),
          level: document.querySelector('[data-stat="level"]')
        };
        
        // İstatistikleri güncelle
        if (statElements.matchesPlayed) statElements.matchesPlayed.textContent = currentUser.matchesPlayed || 0;
        if (statElements.matchesWon) statElements.matchesWon.textContent = currentUser.matchesWon || 0;
        if (statElements.goals) statElements.goals.textContent = currentUser.goals || 0;
        if (statElements.assists) statElements.assists.textContent = currentUser.assists || 0;
        if (statElements.rating) statElements.rating.textContent = (currentUser.rating || 0).toFixed(1);
        if (statElements.totalPoints) statElements.totalPoints.textContent = currentUser.stats?.totalPoints || 0;
        if (statElements.level) statElements.level.textContent = currentUser.stats?.level || 1;
        
        // Pozisyonu güncelle
        const positionElement = document.querySelector('[data-info="position"]');
        if (positionElement) positionElement.textContent = currentUser.position || 'Belirsiz';
        
        // Konum bilgisini güncelle
        const locationElement = document.querySelector('[data-info="location"]');
        if (locationElement) locationElement.textContent = currentUser.location || 'Belirsiz';
      }

      function loadUpcomingMatches() {
        const upcomingMatches = PasliosData.getUpcomingMatches();
        const matchesContainer = document.querySelector('#upcomingMatches');
        
        if (!matchesContainer) return;

        matchesContainer.innerHTML = '';

        if (upcomingMatches.length === 0) {
          matchesContainer.innerHTML = `
            <div class="match-card" style="text-align: center; color: #6b7280;">
              <p>Henüz yaklaşan maç yok</p>
              <a href="create-post.html" style="color: #10b981; text-decoration: underline;">Maç oluştur</a>
            </div>
          `;
          return;
        }

        upcomingMatches.slice(0, 3).forEach(match => {
          const matchCard = createMatchCard(match);
          matchesContainer.appendChild(matchCard);
        });
      }

      function createMatchCard(match) {
        const matchDate = new Date(`${match.date} ${match.time}`);
        const now = new Date();
        const diffTime = matchDate - now;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        let timeText = '';
        if (diffDays === 0) {
          timeText = `Bugün ${match.time}`;
        } else if (diffDays === 1) {
          timeText = `Yarın ${match.time}`;
        } else {
          timeText = `${diffDays} gün sonra`;
        }

        let statusText = '';
        let statusClass = '';
        if (match.type === 'individual') {
          const remaining = match.maxPlayers - match.currentPlayers;
          if (remaining === 0) {
            statusText = 'Tam Dolu';
            statusClass = 'match-status-full';
          } else {
            statusText = `${remaining} Kişi Eksik`;
            statusClass = 'match-status-waiting';
          }
        } else {
          statusText = match.status === 'confirmed' ? 'Onaylandı' : 'Beklemede';
          statusClass = match.status === 'confirmed' ? 'match-status-confirmed' : 'match-status-waiting';
        }

        const matchCard = document.createElement('div');
        matchCard.className = 'match-card';
        matchCard.innerHTML = `
          <div class="match-header">
            <div class="match-time">${timeText}</div>
            <div class="match-status ${statusClass}">${statusText}</div>
          </div>
          <div class="match-title">${match.title}</div>
          <div class="match-location">📍 ${match.location}</div>
          <div class="match-players">
            ${match.type === 'individual' 
              ? `${match.currentPlayers}/${match.maxPlayers} Oyuncu` 
              : `${match.teamA?.name || 'Takım A'} vs ${match.teamB?.name || 'Takım B'}`
            }
          </div>
        `;

        matchCard.addEventListener('click', () => {
          window.location.href = `matches.html?id=${match.id}`;
        });

        return matchCard;
      }

      function loadSocialFeed() {
        console.log('loadSocialFeed çağırıldı');
        const posts = pasliosData.getPosts(5);
        console.log('Bulunan posts:', posts);
        const feedContainer = document.querySelector('#socialFeed');
        console.log('feedContainer:', feedContainer);
        
        if (!feedContainer) {
          console.log('feedContainer bulunamadı!');
          return;
        }

        feedContainer.innerHTML = '';

        if (posts.length === 0) {
          console.log('Hiç gönderi yok, boş mesaj gösteriliyor');
          feedContainer.innerHTML = `
            <div class="post-card" style="text-align: center; color: #6b7280;">
              <p>Henüz gönderi yok</p>
              <a href="create-post.html" style="color: #10b981; text-decoration: underline;">İlk gönderiyi sen oluştur!</a>
            </div>
          `;
          return;
        }

        console.log('Gönderiler yükleniyor:', posts.length, 'adet');
        posts.forEach(post => {
          const postCard = createPostCard(post);
          feedContainer.appendChild(postCard);
        });
        console.log('Gönderiler yüklendi');
      }

      function createPostCard(post) {
        const timeAgo = PasliosData.formatTimeAgo(post.timestamp);
        console.log('createPostCard çağırıldı, post:', post);
        console.log('timeAgo:', timeAgo);
        
        // localStorage'dan gerçek kullanıcı verilerini oku
        const currentUserData = localStorage.getItem('currentUser');
        const currentUser = currentUserData ? JSON.parse(currentUserData) : null;
        const isLiked = currentUser && post.likedBy.includes(currentUser.id);
        
        // Yorum sayısını hesapla
        const commentCount = post.comments ? post.comments.length : 0;
        
        // Yorumları HTML olarak oluştur
        let commentsHtml = '';
        if (post.comments && post.comments.length > 0) {
          commentsHtml = `
            <div class="post-comments-section">
              <div class="comments-header">Yorumlar (${commentCount})</div>
              <div class="comments-list">
                ${post.comments.map(comment => `
                  <div class="comment-item">
                    <div class="comment-avatar">${comment.authorAvatar || '👤'}</div>
                    <div class="comment-content">
                      <div class="comment-header">
                        <span class="comment-author">${comment.authorName}</span>
                        <span class="comment-time">${PasliosData.formatTimeAgo(comment.timestamp)}</span>
                      </div>
                      <div class="comment-text">${comment.content}</div>
                    </div>
                  </div>
                `).join('')}
              </div>
            </div>
          `;
        }

        const postCard = document.createElement('div');
        postCard.className = 'post-card';
        postCard.innerHTML = `
          <div class="post-header">
            <div class="post-avatar">${post.authorAvatar || '👤'}</div>
            <div class="post-info">
              <div class="post-author" onclick="viewUserProfile(${post.authorId})">${post.authorName}</div>
              <div class="post-time">${timeAgo}</div>
            </div>
          </div>
          <div class="post-content">${post.content}</div>
          <div class="post-actions">
            <span class="post-likes ${isLiked ? 'liked' : ''}" onclick="likePost(${post.id}, this)">
              ${isLiked ? '❤️' : '🤍'} ${post.likedBy ? post.likedBy.length : 0}
            </span>
            <span class="post-comments" onclick="commentPost(${post.id}, this)">💬 ${commentCount}</span>
            <span class="post-shares" onclick="sharePost(${post.id}, this)">🔗 0</span>
          </div>
          ${commentsHtml}
        `;

        console.log('Post card oluşturuldu:', postCard);
        return postCard;
      }

      function setupEventListeners() {
        // Make user avatars clickable
        document.querySelectorAll('.user-avatar').forEach(el => {
          el.addEventListener('click', () => {
            window.location.href = 'profile.html';
          });
          el.style.cursor = 'pointer';
        });

        // Comment modal events
        const commentModal = document.getElementById('commentModal');
        if (commentModal) {
          commentModal.addEventListener('click', function(e) {
            if (e.target === this) {
              closeCommentModal();
            }
          });
        }

        const commentText = document.getElementById('commentText');
        if (commentText) {
          // Enable/disable submit button based on textarea content
          commentText.addEventListener('input', function() {
            const submitBtn = document.getElementById('submitComment');
            if (submitBtn) {
              submitBtn.disabled = !this.value.trim();
            }
          });

          // Submit comment on Ctrl+Enter
          commentText.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'Enter') {
              submitComment();
            }
          });
        }
      }

      // Post interaction functions
      function likePost(postId, element) {
        const result = pasliosData.togglePostLike(postId);
        
        if (result) {
          // Güncellenmiş post bilgilerini al
          const posts = pasliosData.getPosts();
          const post = posts.find(p => p.id === postId);
          
          if (post) {
            const currentUserData = localStorage.getItem('currentUser');
            const currentUser = currentUserData ? JSON.parse(currentUserData) : null;
            const isLiked = currentUser && post.likedBy.includes(currentUser.id);
            const likeCount = post.likedBy ? post.likedBy.length : 0;
            
            element.innerHTML = `${isLiked ? '❤️' : '🤍'} ${likeCount}`;
            element.className = `post-likes ${isLiked ? 'liked' : ''}`;
            
            // Add animation
            element.style.transform = 'scale(1.2)';
            setTimeout(() => {
              element.style.transform = 'scale(1)';
            }, 200);
            
            ToastManager.show(
              isLiked ? 'Gönderi beğenildi! ❤️' : 'Beğeni kaldırıldı',
              isLiked ? 'success' : 'info'
            );
          }
        }
      }

      // Comment modal functions
      let currentCommentPostId = null;
      let currentCommentElement = null;
      
      function commentPost(postId, element) {
        console.log('commentPost çağırıldı, postId:', postId, 'element:', element);
        currentCommentPostId = postId;
        currentCommentElement = element;
        
        const posts = pasliosData.getPosts();
        const post = posts.find(p => p.id === postId);
        console.log('Bulunan post:', post);
        
        if (post) {
          // Set author info in modal
          document.getElementById('commentAuthorName').textContent = post.authorName;
          document.getElementById('commentAuthorAvatar').textContent = post.authorAvatar || '👤';
          document.getElementById('commentText').value = '';
          
          // Show modal
          const modal = document.getElementById('commentModal');
          console.log('Modal element:', modal);
          if (modal) {
            modal.style.display = 'flex';
            setTimeout(() => modal.classList.add('show'), 10);
            
            // Focus textarea
            setTimeout(() => document.getElementById('commentText').focus(), 100);
          } else {
            console.error('Comment modal bulunamadı!');
          }
        } else {
          console.error('Post bulunamadı!');
        }
      }
      
      function closeCommentModal() {
        console.log('closeCommentModal çağırıldı');
        const modal = document.getElementById('commentModal');
        const commentText = document.getElementById('commentText');
        
        if (modal) {
          modal.classList.remove('show');
          modal.style.display = 'none'; // Hemen gizle
          console.log('Modal gizlendi');
        }
        
        if (commentText) {
          commentText.value = ''; // Text alanını temizle
        }
        
        currentCommentPostId = null;
        currentCommentElement = null;
        console.log('Modal kapatma işlemi tamamlandı');
      }
      
      function submitComment() {
        console.log('submitComment çağırıldı');
        const commentText = document.getElementById('commentText').value.trim();
        if (!commentText) {
          ToastManager.show('Lütfen bir yorum yazın', 'error');
          return;
        }
        
        if (currentCommentPostId && currentCommentElement) {
          console.log('Yorum ekleniyor...', commentText);
          const result = pasliosData.addComment(currentCommentPostId, commentText);
          
          if (result.success) {
            console.log('Yorum başarıyla eklendi');
            ToastManager.show(`Yorumunuz eklendi!`, 'success');
            
            // Önce modal'ı kapat
            closeCommentModal();
            
            // Sonra feed'i yenile (kısa gecikme)
            setTimeout(() => {
              console.log('Feed yenileniyor...');
              loadSocialFeed();
            }, 100);
          } else {
            console.log('Yorum ekleme hatası:', result.message);
            ToastManager.show(result.message, 'error');
          }
        }
      }

      function sharePost(postId, element) {
        const posts = PasliosData.getPosts();
        const post = posts.find(p => p.id === postId);
        
        if (post) {
          const result = PasliosData.sharePost(postId);
          
          if (result.success) {
            element.textContent = `🔗 ${result.shares}`;
            
            if (navigator.share) {
              navigator.share({
                title: `${post.authorName} - Paslios`,
                text: post.content,
                url: window.location.href
              });
            } else {
              // Fallback for browsers without native sharing
              const shareText = `${post.authorName}: ${post.content}\n\nPaslios uygulamasından paylaşıldı`;
              navigator.clipboard.writeText(shareText).then(() => {
                ToastManager.show('Gönderi panoya kopyalandı! 📋', 'info');
              });
            }
          }
        }
      }

      function viewUserProfile(userId) {
        window.location.href = `user-profile.html?id=${userId}`;
      }
    </script>
  </body>
</html>
