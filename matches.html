<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Paslios - Maçlar">
    <link href="output.css" rel="stylesheet">
    <title>Paslios - Maçlar</title>
    
    <!-- Authentication Guard -->
    <script src="js/auth-guard.js"></script>
    
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f9fafb;
        min-height: 100vh;
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
        padding-bottom: 80px;
      }
      
      .header {
        background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
        padding: 3rem 1rem 2rem 1rem;
        width: 100vw;
        margin-left: calc(-50vw + 50%);
      }
      
      .header-container {
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
      }
      
      .nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.5rem;
      }
      
      .back-btn {
        width: 2.5rem;
        height: 2.5rem;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      
      .nav-center {
        text-align: center;
      }
      
      .nav-center h1 {
        color: white;
        font-size: 1.25rem;
        font-weight: bold;
      }
      
      .nav-center p {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.875rem;
      }
      
      .nav-right {
        width: 2.5rem;
      }
      
      .filters {
        display: flex;
        gap: 0.5rem;
        overflow-x: auto;
        padding-bottom: 0.5rem;
      }
      
      .filter-btn {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        color: white;
        padding: 0.5rem 1rem;
        border-radius: 20px;
        font-size: 0.875rem;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        white-space: nowrap;
      }
      
      .filter-btn.active,
      .filter-btn:hover {
        background: white;
        color: #3b82f6;
      }
      
      .main-content {
        flex: 1;
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
        padding: 1.5rem 1rem;
      }
      
      .match-card {
        background: white;
        border-radius: 16px;
        padding: 1.25rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #f3f4f6;
        transition: all 0.2s;
      }
      
      .match-card:hover {
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        transform: translateY(-1px);
      }
      
      .match-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
      }
      
      .match-time {
        color: #10b981;
        font-size: 0.875rem;
        font-weight: 600;
      }
      
      .match-status {
        padding: 0.25rem 0.75rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
      }
      
      .status-available {
        background: #dcfce7;
        color: #16a34a;
      }
      
      .status-full {
        background: #fee2e2;
        color: #dc2626;
      }
      
      .status-few-left {
        background: #fef3c7;
        color: #d97706;
      }
      
      .match-venue {
        color: #1f2937;
        font-weight: 600;
        font-size: 1rem;
        margin-bottom: 0.5rem;
      }
      
      .match-location {
        color: #6b7280;
        font-size: 0.875rem;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.25rem;
      }
      
      .match-details {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1rem;
        margin-bottom: 1rem;
        padding: 0.75rem;
        background: #f9fafb;
        border-radius: 12px;
      }
      
      .detail-item {
        text-align: center;
      }
      
      .detail-label {
        color: #6b7280;
        font-size: 0.75rem;
        margin-bottom: 0.25rem;
      }
      
      .detail-value {
        color: #1f2937;
        font-weight: 600;
        font-size: 0.875rem;
      }
      
      .match-footer {
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      
      .match-players {
        color: #6b7280;
        font-size: 0.875rem;
      }
      
      .btn-join {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 12px;
        text-decoration: none;
        font-size: 0.875rem;
        font-weight: 600;
        transition: all 0.2s;
        border: none;
        cursor: pointer;
      }
      
      .btn-join:hover {
        transform: translateY(-1px);
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
      }
      
      .btn-join.disabled {
        background: #6b7280;
        cursor: not-allowed;
      }
      
      .btn-join.disabled:hover {
        transform: none;
        box-shadow: none;
      }
      
      .floating-btn {
        position: fixed;
        bottom: 5rem;
        right: 1rem;
        width: 3.5rem;
        height: 3.5rem;
        background: linear-gradient(135deg, #10b981, #059669);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .floating-btn:hover {
        transform: scale(1.1);
      }
      
      .bottom-nav {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background: white;
        border-top: 1px solid #f3f4f6;
        padding: 1rem;
        box-shadow: 0 -4px 6px rgba(0, 0, 0, 0.05);
        z-index: 1000;
      }
      
      .nav-items {
        display: flex;
        justify-content: space-around;
        max-width: 400px;
        margin: 0 auto;
      }
      
      .nav-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .nav-item.active {
        color: #3b82f6;
      }
      
      .nav-item:not(.active) {
        color: #6b7280;
      }
      
      .nav-item:hover {
        color: #3b82f6;
      }
      
      .nav-item span:first-child {
        font-size: 1.25rem;
        margin-bottom: 0.25rem;
      }
      
      .nav-item span:last-child {
        font-size: 0.75rem;
        font-weight: 500;
      }
      
      /* Toast Notifications */
      .toast {
        position: fixed;
        top: 20px;
        left: 50%;
        transform: translateX(-50%);
        background: #10b981;
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 12px;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        opacity: 0;
        transform: translateX(-50%) translateY(-20px);
        transition: all 0.3s ease;
        max-width: 350px;
        text-align: center;
      }
      
      .toast.show {
        opacity: 1;
        transform: translateX(-50%) translateY(0);
      }
      
      .toast.success {
        background: #10b981;
      }
      
      .toast.error {
        background: #ef4444;
      }
      
      .toast.info {
        background: #3b82f6;
      }
      
      /* Modal Styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.5);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
      
      .modal-content {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        max-width: 350px;
        margin: 1rem;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
        transform: scale(0.9);
        transition: transform 0.2s ease;
      }
      
      .modal.show .modal-content {
        transform: scale(1);
      }
      
      .modal-header {
        text-align: center;
        margin-bottom: 1rem;
      }
      
      .modal-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #1f2937;
        margin-bottom: 0.5rem;
      }
      
      .modal-message {
        color: #6b7280;
        line-height: 1.5;
        margin-bottom: 1.5rem;
        white-space: pre-line;
      }
      
      .modal-actions {
        display: flex;
        gap: 0.75rem;
        justify-content: center;
      }
      
      .modal-btn {
        padding: 0.75rem 1.5rem;
        border-radius: 8px;
        font-weight: 500;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.875rem;
      }
      
      .modal-btn-primary {
        background: #10b981;
        color: white;
      }
      
      .modal-btn-primary:hover {
        background: #059669;
        transform: translateY(-1px);
      }
      
      .modal-btn-secondary {
        background: #f3f4f6;
        color: #6b7280;
      }
      
      .modal-btn-secondary:hover {
        background: #e5e7eb;
      }

      /* Tab System */
      .tabs {
        display: flex;
        background: white;
        border-radius: 16px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        margin-bottom: 1.5rem;
        overflow: hidden;
      }

      .tab {
        flex: 1;
        padding: 1rem;
        text-align: center;
        cursor: pointer;
        background: white;
        color: #6b7280;
        font-weight: 600;
        transition: all 0.3s ease;
        border: none;
        font-size: 0.875rem;
      }

      .tab.active {
        background: #047857;
        color: white;
      }

      .tab:hover:not(.active) {
        background: #f0fdf4;
        color: #047857;
      }

      /* Tab Content */
      .tab-content {
        display: none;
      }

      .tab-content.active {
        display: block;
      }

      /* Quick Actions */
      .quick-actions {
        display: flex;
        gap: 0.75rem;
        margin-bottom: 1.5rem;
      }

      .action-btn {
        flex: 1;
        padding: 0.75rem 1rem;
        border: none;
        border-radius: 12px;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.2s ease;
        font-size: 0.875rem;
      }

      .action-btn.primary {
        background: #10b981;
        color: white;
      }

      .action-btn.primary:hover {
        background: #059669;
        transform: translateY(-1px);
      }

      .action-btn.secondary {
        background: #f3f4f6;
        color: #374151;
      }

      .action-btn.secondary:hover {
        background: #e5e7eb;
      }

      /* Team Match Styles */
      .team-match-card {
        background: linear-gradient(135deg, #f0fdf4 0%, #ecfdf5 100%);
        border: 2px solid #10b981;
        border-radius: 16px;
        padding: 1.5rem;
        margin-bottom: 1rem;
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.1);
      }

      .team-match-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
      }

      .team-match-type {
        background: #10b981;
        color: white;
        padding: 0.25rem 0.75rem;
        border-radius: 20px;
        font-size: 0.75rem;
        font-weight: 600;
      }

      .team-participation {
        background: #fef3c7;
        border: 1px solid #f59e0b;
        border-radius: 8px;
        padding: 0.75rem;
        margin-top: 1rem;
      }

      .participation-status {
        font-size: 0.875rem;
        color: #92400e;
        margin-bottom: 0.5rem;
      }

      .team-members-list {
        display: flex;
        flex-wrap: wrap;
        gap: 0.5rem;
      }

      .member-chip {
        background: #10b981;
        color: white;
        padding: 0.25rem 0.5rem;
        border-radius: 12px;
        font-size: 0.75rem;
        font-weight: 500;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-container">
        <!-- Navigation -->
        <div class="nav">
          <a href="home.html" class="back-btn">
            <span style="color: white; font-size: 1.125rem;">←</span>
          </a>
          <div class="nav-center">
            <h1>Maçlar</h1>
            <p>Yakındaki maçları keşfet</p>
          </div>
          <div class="nav-right"></div>
        </div>

        <!-- Filters -->
        <div class="filters">
          <button class="filter-btn active">Tümü</button>
          <button class="filter-btn">Bugün</button>
          <button class="filter-btn">Yarın</button>
          <button class="filter-btn">Bu Hafta</button>
          <button class="filter-btn">Müsait</button>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Tab Navigation -->
      <div class="tabs">
        <button class="tab active" onclick="switchTab('individual-matches')">
          👤 Bireysel Maçlar
        </button>
        <button class="tab" onclick="switchTab('team-matches')">
          🏆 Takım Maçları
        </button>
      </div>

      <!-- Individual Matches Tab -->
      <div id="individual-matches" class="tab-content active">
        <!-- Quick Actions -->
        <div class="quick-actions">
          <button class="action-btn primary" onclick="window.location.href='booking.html'">⚽ Maç Oluştur</button>
          <button class="action-btn secondary" onclick="filterMatches()">🔍 Filtrele</button>
        </div>

        <!-- Individual Match Cards will be loaded dynamically -->
      </div>

    <!-- Team Matches Tab -->
    <div id="team-matches" class="tab-content">
      <!-- Quick Actions for Team -->
      <div class="quick-actions">
        <button class="action-btn primary" onclick="createTeamMatch()">🏆 Takım Maçı Oluştur</button>
        <button class="action-btn secondary" onclick="showTeamSettings()">⚙️ Takım Ayarları</button>
      </div>

      <!-- Team Match Cards will be loaded dynamically -->
    </div>
  </div>

    <!-- Floating Action Button -->
    <a href="booking.html" class="floating-btn">
      <span style="color: white; font-size: 1.5rem;">+</span>
    </a>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
      <div class="nav-items">
        <a href="home.html" class="nav-item">
          <span>🏠</span>
          <span>Ana Sayfa</span>
        </a>
        <a href="matches.html" class="nav-item active">
          <span>⚽</span>
          <span>Maçlar</span>
        </a>
        <a href="messages.html" class="nav-item">
          <span>💌</span>
          <span>Mesajlar</span>
        </a>
        <a href="profile.html" class="nav-item">
          <span>👤</span>
          <span>Profil</span>
        </a>
      </div>
    </div>

    <script>
      // Load required scripts
      const loadScript = (src) => {
        return new Promise((resolve, reject) => {
          const script = document.createElement('script');
          script.src = src;
          script.onload = resolve;
          script.onerror = reject;
          document.head.appendChild(script);
        });
      };

      // Initialize the page
      async function initializePage() {
        try {
          await Promise.all([
            loadScript('js/data.js'),
            loadScript('js/toast.js')
          ]);
          console.log('Scripts loaded successfully');
          
          // Authentication check
          if (!localStorage.getItem('currentUser')) {
            window.location.href = 'index.html';
            return;
          }
          
          loadUserData();
          loadMatches();
          setupFilterButtons();
        } catch (error) {
          console.error('Error loading scripts:', error);
        }
      }

      let currentFilter = 'Tümü';
      let currentUser = null;
      let userTeam = null;
      let allMatches = [];

      function loadUserData() {
        try {
          currentUser = JSON.parse(localStorage.getItem('currentUser'));
          if (currentUser && currentUser.teamId) {
            // Load user team data if available
            userTeam = { id: currentUser.teamId, name: 'Çankaya Tigers' };
          }
        } catch (error) {
          console.error('Error loading user data:', error);
        }
      }

      function setupFilterButtons() {
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(btn => {
          btn.addEventListener('click', function() {
            // Remove active class from all buttons
            filterButtons.forEach(b => b.classList.remove('active'));
            // Add active class to clicked button
            this.classList.add('active');
            currentFilter = this.textContent;
            loadMatches();
          });
        });
      }

      function loadMatches() {
        loadIndividualMatches();
        loadTeamMatches();
      }

      function loadIndividualMatches() {
        // Demo individual matches data
        const demoMatches = [
          {
            id: 1,
            type: 'individual',
            title: '5vs5 Futsal',
            location: 'Arena Spor Kompleksi',
            date: '2025-09-22',
            time: '19:00',
            players: '8/10',
            skill: 'Orta',
            price: '25₺',
            description: 'Eğlenceli futsal maçı arıyoruz!',
            organizer: 'Mehmet Kaya',
            status: 'active'
          },
          {
            id: 2,
            type: 'individual',
            title: '7vs7 Halısaha',
            location: 'Champions League Sahası',
            date: '2025-09-23',
            time: '20:30',
            players: '12/14',
            skill: 'İleri',
            price: '35₺',
            description: 'Rekabetçi maç, iyi seviye oyuncular arıyoruz.',
            organizer: 'Emre Demir',
            status: 'active'
          },
          {
            id: 3,
            type: 'individual',
            title: '6vs6 Gece Maçı',
            location: 'Goal Futsal Center',
            date: '2025-09-24',
            time: '21:00',
            players: '10/12',
            skill: 'Başlangıç',
            price: '20₺',
            description: 'Yeni başlayanlar için ideal!',
            organizer: 'Can Özkan',
            status: 'active'
          }
        ];

        const filteredMatches = demoMatches.filter(match => filterMatch(match));
        const container = document.getElementById('individual-matches');
        
        // Clear existing content
        const existingMatches = container.querySelectorAll('.match-card');
        existingMatches.forEach(card => card.remove());

        if (filteredMatches.length === 0) {
          const noMatches = document.createElement('div');
          noMatches.style.cssText = 'text-align: center; padding: 3rem 1rem; color: #6b7280;';
          noMatches.innerHTML = `
            <div style="font-size: 3rem; margin-bottom: 1rem;">⚽</div>
            <div style="font-weight: 600; margin-bottom: 0.5rem;">Henüz maç bulunamadı</div>
            <div style="font-size: 0.875rem;">Yeni bir maç oluşturmak için "Maç Oluştur" butonunu kullanın</div>
          `;
          container.appendChild(noMatches);
          return;
        }

        filteredMatches.forEach(match => {
          const matchCard = createMatchCard(match);
          container.appendChild(matchCard);
        });
      }

      function loadTeamMatches() {
        const container = document.getElementById('team-matches');
        const existingMatches = container.querySelectorAll('.team-match-card');
        existingMatches.forEach(card => card.remove());

        if (!userTeam) {
          const noTeam = document.createElement('div');
          noTeam.style.cssText = 'text-align: center; padding: 3rem 1rem; color: #6b7280;';
          noTeam.innerHTML = `
            <div style="font-size: 3rem; margin-bottom: 1rem;">🏆</div>
            <div style="font-weight: 600; margin-bottom: 0.5rem;">Takım maçları için takıma katılın</div>
            <div style="font-size: 0.875rem; margin-bottom: 1.5rem;">Takım maçlarına katılmak için önce bir takıma üye olmalısınız</div>
            <button onclick="window.location.href='team.html'" style="background: #10b981; color: white; border: none; border-radius: 8px; padding: 12px 24px; font-weight: 600; cursor: pointer;">
              Takıma Katıl veya Oluştur
            </button>
          `;
          container.appendChild(noTeam);
          return;
        }

        // Demo team matches data
        const demoTeamMatches = [
          {
            id: 1,
            type: 'team',
            homeTeam: 'Çankaya Tigers',
            awayTeam: 'Bahçelievler Sharks',
            location: 'Arena Spor Kompleksi',
            date: '2025-09-25',
            time: '19:00',
            status: 'upcoming'
          },
          {
            id: 2,
            type: 'team',
            homeTeam: 'Çankaya Tigers',
            awayTeam: 'Kızılay Eagles',
            location: 'Champions League Sahası',
            date: '2025-09-28',
            time: '20:00',
            status: 'upcoming'
          }
        ];

        demoTeamMatches.forEach(match => {
          const matchCard = createTeamMatchCard(match);
          container.appendChild(matchCard);
        });
      }

      // Initialize page when DOM is ready
      document.addEventListener('DOMContentLoaded', function() {
        initializePage();
      });

      function filterMatch(match) {
        const matchDate = new Date(match.date);
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const nextWeek = new Date(today);
        nextWeek.setDate(nextWeek.getDate() + 7);

        switch (currentFilter) {
          case 'Bugün':
            return matchDate.toDateString() === today.toDateString();
          case 'Yarın':
            return matchDate.toDateString() === tomorrow.toDateString();
          case 'Bu Hafta':
            return matchDate >= today && matchDate <= nextWeek;
          case 'Müsait':
            return parseInt(match.players.split('/')[0]) < parseInt(match.players.split('/')[1]);
          default:
            return true;
        }
      }

      function createMatchCard(match) {
        const matchCard = document.createElement('div');
        matchCard.className = 'match-card';
        
        const [current, total] = match.players.split('/').map(n => parseInt(n));
        const availableSlots = total - current;
        
        let statusClass = 'status-available';
        let statusText = `${availableSlots} Kişi Eksik`;
        
        if (availableSlots === 0) {
          statusClass = 'status-full';
          statusText = 'Tam Dolu';
        } else if (availableSlots <= 2) {
          statusClass = 'status-few-left';
          statusText = `${availableSlots} Kişi Eksik`;
        }

        const matchDate = new Date(match.date + 'T' + match.time);
        const timeString = formatMatchTime(matchDate);

        matchCard.innerHTML = `
          <div class="match-header">
            <span class="match-time">${timeString}</span>
            <span class="match-status ${statusClass}">${statusText}</span>
          </div>
          <h3 class="match-title">${match.title}</h3>
          <div class="match-venue">${match.location}</div>
          <div class="match-location">
            <span>📍</span>
            <span>${match.location}</span>
          </div>
          <div class="match-details">
            <div class="detail-item">
              <span class="detail-icon">👥</span>
              <span class="detail-text">${match.players}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">⚡</span>
              <span class="detail-text">${match.skill}</span>
            </div>
            <div class="detail-item">
              <span class="detail-icon">💰</span>
              <span class="detail-text">${match.price}</span>
            </div>
          </div>
          <div class="match-description">${match.description}</div>
          <div class="match-organizer">Organizatör: ${match.organizer}</div>
          <div class="match-actions">
            <button class="btn-join ${availableSlots === 0 ? 'disabled' : ''}" 
                    onclick="joinMatch(${match.id})" 
                    ${availableSlots === 0 ? 'disabled' : ''}>
              ${availableSlots === 0 ? 'Dolu' : 'Katıl'}
            </button>
            <button class="btn-details" onclick="showMatchDetails(${match.id})">Detaylar</button>
          </div>
        `;
        
        return matchCard;
      }

      function createTeamMatchCard(match) {
        const matchCard = document.createElement('div');
        matchCard.className = 'team-match-card';
        
        const matchDate = new Date(match.date + 'T' + match.time);
        const timeString = formatMatchTime(matchDate);

        matchCard.innerHTML = `
          <div class="team-match-header">
            <span class="team-match-time">${timeString}</span>
            <span class="team-match-status status-upcoming">Yaklaşan</span>
          </div>
          <div class="team-match-teams">
            <div class="team home-team">
              <div class="team-logo">🐅</div>
              <div class="team-name">${match.homeTeam}</div>
            </div>
            <div class="match-vs">VS</div>
            <div class="team away-team">
              <div class="team-logo">🦈</div>
              <div class="team-name">${match.awayTeam}</div>
            </div>
          </div>
          <div class="team-match-location">
            <span>📍</span>
            <span>${match.location}</span>
          </div>
          <div class="team-match-actions">
            <button class="btn-team-details" onclick="showTeamMatchDetails(${match.id})">Detaylar</button>
            <button class="btn-team-prepare" onclick="prepareForMatch(${match.id})">Hazırlan</button>
          </div>
        `;
        
        return matchCard;
      }

      function formatMatchTime(date) {
        const now = new Date();
        const diffTime = date.getTime() - now.getTime();
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        
        const timeStr = date.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        
        if (diffDays === 0) {
          return `Bugün ${timeStr}`;
        } else if (diffDays === 1) {
          return `Yarın ${timeStr}`;
        } else if (diffDays <= 7) {
          return `${diffDays} gün sonra ${timeStr}`;
        } else {
          return date.toLocaleDateString('tr-TR') + ' ' + timeStr;
        }
      }

      function joinMatch(matchId) {
        if (window.ToastManager) {
          ToastManager.show('Maça katılım başarılı! 🎉', 'success');
        }
        // Reload matches to update UI
        setTimeout(() => {
          loadMatches();
        }, 1000);
      }

      function showMatchDetails(matchId) {
        if (window.ToastManager) {
          ToastManager.show('Maç detayları açılıyor...', 'info');
        }
      }

      function showTeamMatchDetails(matchId) {
        if (window.ToastManager) {
          ToastManager.show('Takım maçı detayları açılıyor...', 'info');
        }
      }

      function prepareForMatch(matchId) {
        if (window.ToastManager) {
          ToastManager.show('Maç hazırlığı başlatılıyor...', 'info');
        }
      }

      // Modal functions for match creation
      function openIndividualMatchModal() {
        const matchDate = new Date(match.date);
        const today = new Date();
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        const nextWeek = new Date(today);
        nextWeek.setDate(nextWeek.getDate() + 7);

        switch (currentFilter) {
          case 'Bugün':
            return matchDate.toDateString() === today.toDateString();
          case 'Yarın':
            return matchDate.toDateString() === tomorrow.toDateString();
          case 'Bu Hafta':
            return matchDate >= today && matchDate <= nextWeek;
          case 'Müsait':
            return match.availableSlots > 0;
          default:
            return true;
        }
      }

      function createMatchCard(match) {
        const venue = PasliosData.getVenue(match.venueId);
        const isUserJoined = match.participants?.includes(currentUser.id);
        const availableSlots = match.maxPlayers - (match.participants?.length || 0);
        
        const matchCard = document.createElement('div');
        matchCard.className = 'match-card';
        
        let statusClass = 'status-available';
        let statusText = `${availableSlots} Kişi Eksik`;
        
        if (availableSlots === 0) {
          statusClass = 'status-full';
          statusText = 'Tam Dolu';
        } else if (availableSlots <= 2) {
          statusClass = 'status-few-left';
          statusText = `${availableSlots} Kişi Eksik`;
        }

        const matchDate = new Date(match.date);
        const timeString = formatMatchTime(matchDate);

        matchCard.innerHTML = `
          <div class="match-header">
            <span class="match-time">${timeString}</span>
            <span class="match-status ${statusClass}">${statusText}</span>
          </div>
          <div class="match-venue">${venue ? venue.name : 'Saha Bilgisi Yok'}</div>
          <div class="match-location">
            <span>📍</span>
            <span>${venue ? venue.location : 'Konum Bilgisi Yok'} ${venue && venue.distance ? `(${venue.distance} km)` : ''}</span>
          </div>
          <div class="match-details">
            <div class="detail-item">
              <div class="detail-label">Süre</div>
              <div class="detail-value">${match.duration || '90'} dk</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">Ücret</div>
              <div class="detail-value">₺${match.pricePerPerson || '25'}</div>
            </div>
          </div>
          <div class="match-footer">
            <span class="match-players">${match.participants?.length || 0}/${match.maxPlayers} Oyuncu</span>
            <button class="btn-join ${isUserJoined ? 'joined' : availableSlots === 0 ? 'disabled' : ''}" 
                    onclick="${isUserJoined ? `leaveMatch('${match.id}')` : availableSlots > 0 ? `joinMatch('${match.id}')` : ''}"
                    ${availableSlots === 0 && !isUserJoined ? 'disabled' : ''}>
              ${isUserJoined ? 'Ayrıl' : availableSlots === 0 ? 'Dolu' : 'Katıl'}
            </button>
          </div>
        `;

        return matchCard;
      }

      function createTeamMatchCard(match) {
        const homeTeam = PasliosData.getTeam(match.homeTeamId);
        const awayTeam = PasliosData.getTeam(match.awayTeamId);
        const venue = PasliosData.getVenue(match.venueId);
        const teamMembers = PasliosData.getTeamMembers(userTeam.id);
        
        const matchCard = document.createElement('div');
        matchCard.className = 'team-match-card';
        
        const matchDate = new Date(match.date);
        const timeString = formatMatchTime(matchDate);
        
        let statusClass = 'status-available';
        let statusText = 'Takım Aranıyor';
        
        if (match.status === 'completed') {
          statusClass = 'status-full';
          statusText = `${match.result || 'Tamamlandı'}`;
          matchCard.style.cssText = 'background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); border-color: #9ca3af;';
        } else if (match.homeTeamId && match.awayTeamId) {
          statusClass = 'status-few-left';
          statusText = 'Maç Onaylandı';
        }

        const isCompleted = match.status === 'completed';
        const participatingMembers = teamMembers.filter(member => 
          match.teamParticipants?.[userTeam.id]?.includes(member.userId)
        );

        matchCard.innerHTML = `
          <div class="team-match-header">
            <div>
              <span class="team-match-type ${isCompleted ? 'style="background: #6b7280;"' : ''}">${match.format || 'TAKIMLAR ARASI'}</span>
              <div style="font-size: 0.875rem; color: #6b7280; margin-top: 0.25rem;">${timeString}</div>
            </div>
            <span class="match-status ${statusClass} ${isCompleted ? 'style="background: #dcfce7; color: #16a34a;"' : ''}">${statusText}</span>
          </div>
          
          <div class="match-venue">
            🏆 ${homeTeam?.name || userTeam.name} vs ${awayTeam?.name || 'Rakip Takım'}
          </div>
          <div class="match-location">
            <span>📍</span>
            <span>${venue ? venue.name + ', ' + venue.location : 'Saha bilgisi eklenecek'}</span>
          </div>
          
          <div class="match-details">
            <div class="detail-item">
              <div class="detail-label">Süre</div>
              <div class="detail-value">${match.duration || '90'} dk</div>
            </div>
            <div class="detail-item">
              <div class="detail-label">${isCompleted ? 'Sonuç' : 'Takım Ücreti'}</div>
              <div class="detail-value">${isCompleted ? (match.score || '0-0') : '₺' + (match.teamPrice || '300')}</div>
            </div>
          </div>

          <div class="team-participation ${isCompleted ? 'style="background: #f0fdf4; border-color: #10b981;"' : ''}">
            <div class="participation-status ${isCompleted ? 'style="color: #166534;"' : ''}">
              <strong>${isCompleted ? 'Maç Sonucu:' : 'Takımınızdan Katılım Durumu:'}</strong> 
              ${isCompleted ? (match.points ? `+${match.points} puan kazandınız! 🎉` : 'Sonuç bekleniyor') : `${participatingMembers.length}/${teamMembers.length} oyuncu`}
            </div>
            <div class="team-members-list">
              ${teamMembers.map(member => {
                const isParticipating = participatingMembers.some(p => p.userId === member.userId);
                const chipStyle = isParticipating ? '' : 'background: #6b7280;';
                const memberName = member.name.split(' ').map(n => n[0]).join('') + '.';
                return `<span class="member-chip" style="${chipStyle}">${memberName}${isCompleted && isParticipating ? ' ⭐' : isParticipating ? '' : ' (Yok)'}</span>`;
              }).join('')}
            </div>
          </div>

          <div class="match-footer" style="margin-top: 1rem;">
            ${isCompleted ? 
              '<button class="btn-join" disabled style="background: #9ca3af;">Tamamlandı</button>' :
              `<button class="btn-join" onclick="manageTeamParticipation('${match.id}')">Katılımı Yönet</button>`
            }
          </div>
        `;

        return matchCard;
      }

      function formatMatchTime(date) {
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const tomorrow = new Date(today);
        tomorrow.setDate(tomorrow.getDate() + 1);
        
        const matchDay = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        
        const timeStr = date.toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });
        
        if (matchDay.getTime() === today.getTime()) {
          return `Bugün ${timeStr}`;
        } else if (matchDay.getTime() === tomorrow.getTime()) {
          return `Yarın ${timeStr}`;
        } else {
          return date.toLocaleDateString('tr-TR', { 
            weekday: 'long', 
            hour: '2-digit', 
            minute: '2-digit' 
          });
        }
      }

      function joinMatch(matchId) {
        const match = PasliosData.getMatch(matchId);
        if (!match) return;

        if (match.participants?.includes(currentUser.id)) {
          showToast('Zaten bu maça katıldınız!', 'error');
          return;
        }

        if ((match.participants?.length || 0) >= match.maxPlayers) {
          showToast('Bu maç dolu!', 'error');
          return;
        }

        // Add user to match
        PasliosData.addPlayerToMatch(matchId, currentUser.id);
        
        // Create notification for match organizer
        if (match.organizerId && match.organizerId !== currentUser.id) {
          PasliosData.createNotification(match.organizerId, {
            type: 'match_join',
            title: 'Yeni Katılımcı',
            message: `${currentUser.name} "${match.title || 'Maç'}" etkinliğine katıldı.`,
            actionUrl: `match-details.html?id=${matchId}`
          });
        }

        showToast('Maça başarıyla katıldınız! 🎉', 'success');
        loadIndividualMatches();
      }

      function leaveMatch(matchId) {
        if (!confirm('Bu maçtan ayrılmak istediğinizden emin misiniz?')) {
          return;
        }

        PasliosData.removePlayerFromMatch(matchId, currentUser.id);
        
        const match = PasliosData.getMatch(matchId);
        if (match?.organizerId && match.organizerId !== currentUser.id) {
          PasliosData.createNotification(match.organizerId, {
            type: 'match_leave',
            title: 'Katılımcı Ayrıldı',
            message: `${currentUser.name} "${match.title || 'Maç'}" etkinliğinden ayrıldı.`,
            actionUrl: `match-details.html?id=${matchId}`
          });
        }

        showToast('Maçtan ayrıldınız.', 'success');
        loadIndividualMatches();
      }

      function createMatch() {
        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          opacity: 0;
          transition: opacity 0.3s ease;
        `;

        modal.innerHTML = `
          <div style="background: white; border-radius: 16px; padding: 2rem; width: 90%; max-width: 350px; max-height: 80vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease;">
            <h3 style="margin-bottom: 1.5rem; color: #1f2937; font-weight: bold; text-align: center;">⚽ Yeni Maç Oluştur</h3>
            
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Maç Başlığı:</label>
              <input type="text" id="matchTitle" placeholder="Örn: Akşam Halısaha Maçı" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Tarih:</label>
                <input type="date" id="matchDate" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Saat:</label>
                <input type="time" id="matchTime" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
              </div>
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Saha:</label>
              <select id="matchVenue" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                <option value="">Saha seçin...</option>
              </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Oyuncu Sayısı:</label>
                <select id="maxPlayers" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                  <option value="8">8 Kişi</option>
                  <option value="10" selected>10 Kişi</option>
                  <option value="12">12 Kişi</option>
                  <option value="14">14 Kişi</option>
                  <option value="16">16 Kişi</option>
                  <option value="18">18 Kişi</option>
                  <option value="20">20 Kişi</option>
                  <option value="22">22 Kişi</option>
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Süre (dk):</label>
                <select id="matchDuration" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                  <option value="60">60 dk</option>
                  <option value="90" selected>90 dk</option>
                  <option value="120">120 dk</option>
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Ücret (₺):</label>
                <input type="number" id="matchPrice" min="0" max="100" value="25" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
              </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Açıklama:</label>
              <textarea id="matchDescription" placeholder="Maç hakkında ek bilgiler..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; height: 80px; resize: vertical;"></textarea>
            </div>

            <div style="display: flex; gap: 12px;">
              <button onclick="submitMatch()" style="flex: 1; background: #10b981; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ✅ Maç Oluştur
              </button>
              <button onclick="closeModal()" style="flex: 1; background: #6b7280; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ❌ İptal
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);
        window.currentModal = modal;

        // Populate venues
        const venues = PasliosData.getAllVenues();
        const venueSelect = document.getElementById('matchVenue');
        venues.forEach(venue => {
          const option = document.createElement('option');
          option.value = venue.id;
          option.textContent = `${venue.name} - ${venue.location}`;
          venueSelect.appendChild(option);
        });

        // Set default date to today
        const today = new Date();
        document.getElementById('matchDate').value = today.toISOString().split('T')[0];

        // Show modal with animation
        setTimeout(() => {
          modal.style.opacity = '1';
          modal.querySelector('div').style.transform = 'scale(1)';
        }, 10);
      }

      function submitMatch() {
        const title = document.getElementById('matchTitle').value.trim();
        const date = document.getElementById('matchDate').value;
        const time = document.getElementById('matchTime').value;
        const venueId = document.getElementById('matchVenue').value;
        const maxPlayers = parseInt(document.getElementById('maxPlayers').value);
        const duration = parseInt(document.getElementById('matchDuration').value);
        const price = parseFloat(document.getElementById('matchPrice').value);
        const description = document.getElementById('matchDescription').value.trim();

        // Validation
        if (!title) {
          showToast('Maç başlığı gerekli!', 'error');
          return;
        }

        if (!date || !time) {
          showToast('Tarih ve saat gerekli!', 'error');
          return;
        }

        if (!venueId) {
          showToast('Saha seçimi gerekli!', 'error');
          return;
        }

        const matchDateTime = new Date(`${date}T${time}`);
        if (matchDateTime <= new Date()) {
          showToast('Maç tarihi gelecekte olmalı!', 'error');
          return;
        }

        // Create match data
        const matchData = {
          title: title,
          description: description,
          date: matchDateTime.toISOString(),
          venueId: venueId,
          maxPlayers: maxPlayers,
          duration: duration,
          pricePerPerson: price,
          type: 'individual',
          organizerId: currentUser.id,
          participants: [currentUser.id], // Organizer automatically joins
          status: 'open'
        };

        const newMatch = PasliosData.createMatch(matchData);
        
        showToast('Maç başarıyla oluşturuldu! 🎉', 'success');
        closeModal();
        
        // Reload matches
        loadIndividualMatches();
      }

      function createTeamMatch() {
        if (!userTeam) {
          showToast('Takım maçı oluşturmak için önce bir takıma katılmalısınız!', 'error');
          return;
        }

        if (currentUser.id !== userTeam.captainId) {
          showToast('Sadece takım kaptanı takım maçı oluşturabilir!', 'error');
          return;
        }

        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          opacity: 0;
          transition: opacity 0.3s ease;
        `;

        modal.innerHTML = `
          <div style="background: white; border-radius: 16px; padding: 2rem; width: 90%; max-width: 350px; max-height: 80vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease;">
            <h3 style="margin-bottom: 1.5rem; color: #1f2937; font-weight: bold; text-align: center;">🏆 Takım Maçı Oluştur</h3>
            
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Maç Türü:</label>
              <select id="teamMatchType" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                <option value="friendly">Dostluk Maçı</option>
                <option value="competitive">Yarışmacı Maç</option>
                <option value="tournament">Turnuva</option>
              </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Tarih:</label>
                <input type="date" id="teamMatchDate" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Saat:</label>
                <input type="time" id="teamMatchTime" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
              </div>
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Saha:</label>
              <select id="teamMatchVenue" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                <option value="">Saha seçin...</option>
              </select>
            </div>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; margin-bottom: 1rem;">
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Süre (dk):</label>
                <select id="teamMatchDuration" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
                  <option value="90" selected>90 dk</option>
                  <option value="120">120 dk</option>
                </select>
              </div>
              <div>
                <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Takım Ücreti (₺):</label>
                <input type="number" id="teamMatchPrice" min="0" max="1000" value="300" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px;">
              </div>
            </div>

            <div style="margin-bottom: 1.5rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Maç Açıklaması:</label>
              <textarea id="teamMatchDescription" placeholder="Maç hakkında detaylar..." style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; height: 80px; resize: vertical;"></textarea>
            </div>

            <div style="display: flex; gap: 12px;">
              <button onclick="submitTeamMatch()" style="flex: 1; background: #10b981; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ✅ Maç Oluştur
              </button>
              <button onclick="closeModal()" style="flex: 1; background: #6b7280; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ❌ İptal
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);
        window.currentModal = modal;

        // Populate venues
        const venues = PasliosData.getAllVenues();
        const venueSelect = document.getElementById('teamMatchVenue');
        venues.forEach(venue => {
          const option = document.createElement('option');
          option.value = venue.id;
          option.textContent = `${venue.name} - ${venue.location}`;
          venueSelect.appendChild(option);
        });

        // Set default date to today
        const today = new Date();
        document.getElementById('teamMatchDate').value = today.toISOString().split('T')[0];

        // Show modal with animation
        setTimeout(() => {
          modal.style.opacity = '1';
          modal.querySelector('div').style.transform = 'scale(1)';
        }, 10);
      }

      function submitTeamMatch() {
        const type = document.getElementById('teamMatchType').value;
        const date = document.getElementById('teamMatchDate').value;
        const time = document.getElementById('teamMatchTime').value;
        const venueId = document.getElementById('teamMatchVenue').value;
        const duration = parseInt(document.getElementById('teamMatchDuration').value);
        const price = parseFloat(document.getElementById('teamMatchPrice').value);
        const description = document.getElementById('teamMatchDescription').value.trim();

        // Validation
        if (!date || !time) {
          showToast('Tarih ve saat gerekli!', 'error');
          return;
        }

        if (!venueId) {
          showToast('Saha seçimi gerekli!', 'error');
          return;
        }

        const matchDateTime = new Date(`${date}T${time}`);
        if (matchDateTime <= new Date()) {
          showToast('Maç tarihi gelecekte olmalı!', 'error');
          return;
        }

        // Create team match data
        const matchData = {
          title: `${userTeam.name} Takım Maçı`,
          description: description,
          date: matchDateTime.toISOString(),
          venueId: venueId,
          duration: duration,
          teamPrice: price,
          type: 'team',
          format: type.toUpperCase(),
          homeTeamId: userTeam.id,
          awayTeamId: null, // Will be filled when another team joins
          organizerId: currentUser.id,
          status: 'open',
          teamParticipants: {
            [userTeam.id]: [] // Will be filled by team members
          }
        };

        const newMatch = PasliosData.createMatch(matchData);
        
        showToast('Takım maçı başarıyla oluşturuldu! 🏆', 'success');
        closeModal();
        
        // Reload team matches
        loadTeamMatches();
      }

      function manageTeamParticipation(matchId) {
        const match = PasliosData.getMatch(matchId);
        if (!match || !userTeam) return;

        const teamMembers = PasliosData.getTeamMembers(userTeam.id);
        const currentParticipants = match.teamParticipants?.[userTeam.id] || [];

        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          opacity: 0;
          transition: opacity 0.3s ease;
        `;

        modal.innerHTML = `
          <div style="background: white; border-radius: 16px; padding: 2rem; width: 90%; max-width: 350px; max-height: 80vh; overflow-y: auto; transform: scale(0.9); transition: transform 0.3s ease;">
            <h3 style="margin-bottom: 1.5rem; color: #1f2937; font-weight: bold; text-align: center;">🏆 Takım Katılımı</h3>
            
            <div style="margin-bottom: 1.5rem;">
              <h4 style="margin-bottom: 1rem; color: #374151;">Takım Üyeleri:</h4>
              
              <div id="teamMembersList">
                ${teamMembers.map(member => `
                  <div style="margin-bottom: 0.75rem;">
                    <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                      <input type="checkbox" data-member-id="${member.userId}" ${currentParticipants.includes(member.userId) ? 'checked' : ''}>
                      <span>${member.name}${member.role === 'captain' ? ' (Kaptan)' : ''}</span>
                    </label>
                  </div>
                `).join('')}
              </div>
            </div>

            <div style="display: flex; gap: 12px;">
              <button onclick="saveTeamParticipation('${matchId}')" style="flex: 1; background: #10b981; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ✅ Kaydet
              </button>
              <button onclick="closeModal()" style="flex: 1; background: #6b7280; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ❌ İptal
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);
        window.currentModal = modal;

        // Show modal with animation
        setTimeout(() => {
          modal.style.opacity = '1';
          modal.querySelector('div').style.transform = 'scale(1)';
        }, 10);
      }

      function saveTeamParticipation(matchId) {
        const checkboxes = document.querySelectorAll('#teamMembersList input[type="checkbox"]');
        const participants = [];
        
        checkboxes.forEach(checkbox => {
          if (checkbox.checked) {
            participants.push(checkbox.dataset.memberId);
          }
        });

        // Update match participation
        PasliosData.updateMatch(matchId, {
          [`teamParticipants.${userTeam.id}`]: participants
        });

        showToast(`Katılım güncellendi: ${participants.length} oyuncu seçildi`, 'success');
        closeModal();
        
        // Reload team matches
        loadTeamMatches();
      }

      function filterMatches() {
        showToast('Gelişmiş filtreler geliştiriliyor...', 'info');
        // TODO: Implement advanced filtering modal
      }

      function showTeamSettings() {
        if (!userTeam) {
          showToast('Takım ayarları için önce bir takıma katılmalısınız!', 'error');
          return;
        }
        
        window.location.href = 'team.html';
      }

      function closeModal() {
        if (window.currentModal) {
          window.currentModal.style.opacity = '0';
          window.currentModal.querySelector('div').style.transform = 'scale(0.9)';
          setTimeout(() => {
            window.currentModal.remove();
            window.currentModal = null;
          }, 300);
        }
      }

      // Toast functions
      function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
          color: white;
          padding: 12px 20px;
          border-radius: 12px;
          font-weight: 600;
          z-index: 9999;
          opacity: 0;
          transform: translateX(100%);
          transition: all 0.3s ease;
          max-width: 300px;
        `;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        // Show toast
        setTimeout(() => {
          toast.style.opacity = '1';
          toast.style.transform = 'translateX(0)';
        }, 100);
        
        // Hide and remove toast
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateX(100%)';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // Tab switching functionality
      function switchTab(tabId) {
        // Hide all tab contents
        const tabContents = document.querySelectorAll('.tab-content');
        tabContents.forEach(content => {
          content.classList.remove('active');
        });

        // Remove active class from all tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
          tab.classList.remove('active');
        });

        // Show selected tab content
        document.getElementById(tabId).classList.add('active');

        // Add active class to clicked tab
        event.target.classList.add('active');
      }

      // Toast functions
      function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.className = `toast ${type}`;
        toast.textContent = message;
        
        document.getElementById('toastContainer').appendChild(toast);
        
        // Show toast
        setTimeout(() => toast.classList.add('show'), 100);
        
        // Hide and remove toast
        setTimeout(() => {
          toast.classList.remove('show');
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }

      // Tab switching functionality
      function switchTab(tabId) {
        // Hide all tab contents
        const tabContents = document.querySelectorAll('.tab-content');
        tabContents.forEach(content => {
          content.classList.remove('active');
        });

        // Remove active class from all tabs
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => {
          tab.classList.remove('active');
        });

        // Show selected tab content
        document.getElementById(tabId).classList.add('active');

        // Add active class to clicked tab
        event.target.classList.add('active');
      }

      // Team match functions
      function createTeamMatch() {
        showToast('Takım maçı oluşturma sayfasına yönlendiriliyor...', 'info');
        // In real app: window.location.href = 'create-team-match.html';
      }

      function showTeamSettings() {
        showToast('Takım ayarları açılıyor...', 'info');
        // In real app: window.location.href = 'team-management.html';
      }

      function manageTeamParticipation() {
        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          opacity: 0;
          transition: opacity 0.3s ease;
        `;

        modal.innerHTML = `
          <div style="background: white; border-radius: 16px; padding: 2rem; width: 90%; max-width: 350px; transform: scale(0.9); transition: transform 0.3s ease;">
            <h3 style="margin-bottom: 1.5rem; color: #1f2937; font-weight: bold; text-align: center;">🏆 Takım Katılımı</h3>
            
            <div style="margin-bottom: 1.5rem;">
              <h4 style="margin-bottom: 1rem; color: #374151;">Takım Üyeleri:</h4>
              
              <div style="margin-bottom: 0.75rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                  <input type="checkbox" checked>
                  <span>Ahmet Yılmaz (Kaptan)</span>
                </label>
              </div>
              
              <div style="margin-bottom: 0.75rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                  <input type="checkbox" checked>
                  <span>Mehmet Kaya</span>
                </label>
              </div>
              
              <div style="margin-bottom: 0.75rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                  <input type="checkbox" checked>
                  <span>Emre Demir</span>
                </label>
              </div>
              
              <div style="margin-bottom: 0.75rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                  <input type="checkbox" checked>
                  <span>Can Özkan</span>
                </label>
              </div>
              
              <div style="margin-bottom: 0.75rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                  <input type="checkbox">
                  <span>Burak Tunç</span>
                </label>
              </div>
              
              <div style="margin-bottom: 0.75rem;">
                <label style="display: flex; align-items: center; gap: 0.5rem; padding: 0.5rem; border-radius: 8px; cursor: pointer;" onmouseover="this.style.background='#f9fafb'" onmouseout="this.style.background='white'">
                  <input type="checkbox">
                  <span>Ali Şen</span>
                </label>
              </div>
            </div>

            <div style="display: flex; gap: 12px;">
              <button onclick="saveTeamParticipation()" style="flex: 1; background: #10b981; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ✅ Kaydet
              </button>
              <button onclick="closeTeamModal()" style="flex: 1; background: #6b7280; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ❌ İptal
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);
        window.currentTeamModal = modal;

        // Show modal with animation
        setTimeout(() => {
          modal.style.opacity = '1';
          modal.querySelector('div').style.transform = 'scale(1)';
        }, 10);
      }

      function closeTeamModal() {
        if (window.currentTeamModal) {
          window.currentTeamModal.style.opacity = '0';
          window.currentTeamModal.querySelector('div').style.transform = 'scale(0.9)';
          setTimeout(() => {
            window.currentTeamModal.remove();
            window.currentTeamModal = null;
          }, 300);
        }
      }

      function saveTeamParticipation() {
        const checkboxes = window.currentTeamModal.querySelectorAll('input[type="checkbox"]');
        const participants = [];
        
        checkboxes.forEach((checkbox, index) => {
          if (checkbox.checked) {
            const memberName = checkbox.parentElement.querySelector('span').textContent;
            participants.push(memberName);
          }
        });

        showToast(`Takım katılımı güncellendi! ${participants.length} oyuncu katılacak.`, 'success');
        closeTeamModal();
        
        // Update the UI
        console.log('Team Participants:', participants);
      }

      function joinTournament() {
        showToast('Turnuva katılım onayı gönderildi! 🏅', 'success');
      }

      function createTeamMatch() {
        const modal = document.createElement('div');
        modal.style.cssText = `
          position: fixed;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background: rgba(0,0,0,0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 10000;
          opacity: 0;
          transition: opacity 0.3s ease;
        `;

        modal.innerHTML = `
          <div style="background: white; border-radius: 16px; padding: 2rem; width: 90%; max-width: 350px; transform: scale(0.9); transition: transform 0.3s ease;">
            <h3 style="margin-bottom: 1.5rem; color: #1f2937; font-weight: bold; text-align: center;">🏆 Takım Maçı Oluştur</h3>
            
            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Maç Türü:</label>
              <select style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px;">
                <option>Takımlar Arası Dostluk Maçı</option>
                <option>Turnuva Katılımı</option>
                <option>Lig Maçı</option>
              </select>
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Tarih & Saat:</label>
              <input type="datetime-local" style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px;">
            </div>

            <div style="margin-bottom: 1rem;">
              <label style="display: block; margin-bottom: 0.5rem; color: #374151; font-weight: 600;">Saha:</label>
              <select style="width: 100%; padding: 12px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 16px;">
                <option>Elite Sports Center</option>
                <option>Spor A Halısaha</option>
                <option>Goal Arena</option>
                <option>Futbol Park</option>
              </select>
            </div>

            <div style="background: #fef3c7; border: 1px solid #f59e0b; border-radius: 8px; padding: 12px; margin-bottom: 1.5rem;">
              <p style="margin: 0; font-size: 0.875rem; color: #92400e;">
                💡 <strong>Not:</strong> Takım maçı oluşturulduktan sonra takım üyeleriniz bilgilendirilecek ve katılım durumları sorulacak.
              </p>
            </div>

            <div style="display: flex; gap: 12px;">
              <button onclick="submitTeamMatch()" style="flex: 1; background: #10b981; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                🏆 Oluştur
              </button>
              <button onclick="closeTeamModal()" style="flex: 1; background: #6b7280; color: white; padding: 12px; border: none; border-radius: 8px; font-weight: 600; cursor: pointer;">
                ❌ İptal
              </button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);
        window.currentTeamModal = modal;

        // Show modal with animation
        setTimeout(() => {
          modal.style.opacity = '1';
          modal.querySelector('div').style.transform = 'scale(1)';
        }, 10);
      }

      function submitTeamMatch() {
        showToast('Takım maçı oluşturuldu! Takım üyelerine bildirim gönderildi. 🏆', 'success');
        closeTeamModal();
      }
      
      // Modal functions
      function showModal(title, message, onConfirm) {
        const modal = document.getElementById('confirmationModal');
        document.getElementById('modalTitle').textContent = title;
        document.getElementById('modalMessage').textContent = message;
        
        const confirmBtn = document.getElementById('confirmBtn');
        confirmBtn.onclick = () => {
          onConfirm();
          closeModal();
        };
        
        modal.style.display = 'flex';
        setTimeout(() => modal.classList.add('show'), 10);
      }
      
      function closeModal() {
        const modal = document.getElementById('confirmationModal');
        modal.classList.remove('show');
        setTimeout(() => modal.style.display = 'none', 200);
      }

      function filterMatches(filter, element) {
        currentFilter = filter;
        
        // Update active filter button
        document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
        element.classList.add('active');
        
        // Show/hide matches based on filter
        const matchCards = document.querySelectorAll('.match-card');
        
        matchCards.forEach(card => {
          const timeText = card.querySelector('.match-time').textContent;
          let shouldShow = true;
          
          switch(filter) {
            case 'Bugün':
              shouldShow = timeText.includes('Bugün');
              break;
            case 'Yarın':
              shouldShow = timeText.includes('Yarın');
              break;
            case 'Bu Hafta':
              shouldShow = timeText.includes('Bugün') || timeText.includes('Yarın') || 
                          timeText.includes('Pazartesi') || timeText.includes('Salı') || 
                          timeText.includes('Çarşamba') || timeText.includes('Perşembe') || 
                          timeText.includes('Cuma');
              break;
            case 'Müsait':
              const joinBtn = card.querySelector('.btn-join');
              shouldShow = !joinBtn.classList.contains('disabled');
              break;
            default:
              shouldShow = true;
          }
          
          if (shouldShow) {
            card.style.display = 'block';
            card.style.animation = 'fadeIn 0.3s ease-in-out';
          } else {
            card.style.display = 'none';
          }
        });
        
        // Show filter result message
        setTimeout(() => {
          const visibleMatches = document.querySelectorAll('.match-card[style*="display: block"]').length;
          if (visibleMatches === 0) {
            showToast(`${filter} kategorisinde henüz maç bulunmuyor. 😔`, 'info');
          }
        }, 300);
      }

      function joinMatch(element, matchName, time) {
        if (element.classList.contains('disabled')) {
          showToast('Bu maç dolu! 😞\n\nBaşka maçlara bakabilir veya yeni bir maç oluşturabilirsiniz.', 'error');
          return;
        }
        
        const message = `Maça katılmak istediğinizden emin misiniz?\n\n🏟️ ${matchName}\n⏰ ${time}\n\nKatılım onaylandıktan sonra diğer oyuncularla iletişime geçebileceksiniz.`;
        
        showModal('Maça Katıl', message, () => {
          // Update button state
          element.textContent = 'Katıldın ✓';
          element.style.backgroundColor = '#10b981';
          element.disabled = true;
          
          // Update player count
          const playersElement = element.closest('.match-card').querySelector('.match-players');
          const currentPlayers = parseInt(playersElement.textContent.match(/\d+/)[0]);
          const maxPlayers = parseInt(playersElement.textContent.match(/\/(\d+)/)[1]);
          
          if (currentPlayers < maxPlayers) {
            const newCount = currentPlayers + 1;
            playersElement.textContent = `${newCount}/${maxPlayers} Oyuncu`;
            
            // Check if match is now full
            if (newCount === maxPlayers) {
              const statusElement = element.closest('.match-card').querySelector('.match-status');
              statusElement.textContent = 'Tam Dolu';
              statusElement.style.backgroundColor = '#ef4444';
            } else {
              const statusElement = element.closest('.match-card').querySelector('.match-status');
              const remaining = maxPlayers - newCount;
              statusElement.textContent = `${remaining} Kişi Eksik`;
            }
          }
          
          showToast(`Tebrikler! Maça başarıyla katıldınız! 🎉\n\nMaç saatinden önce size bildirim gönderilecek.\nDiğer oyuncularla mesajlaşmak için maç detayına girebilirsiniz.`, 'success');
        });
      }

      function viewMatchDetails(matchCard) {
        const matchName = matchCard.querySelector('.match-title').textContent;
        const time = matchCard.querySelector('.match-time').textContent;
        const location = matchCard.querySelector('.match-location').textContent;
        const players = matchCard.querySelector('.match-players').textContent;
        
        const details = `📋 MAÇ DETAYLARI\n\n🏟️ ${matchName}\n⏰ ${time}\n${location}\n👥 ${players}\n\nDetayları görmek için Tamam'a basın.`;
        
        showModal('Maç Detayları', details, () => {
          // Redirect to match details page (to be created)
          showToast('Maç detay sayfası yakında eklenecek! 🚧', 'info');
        });
      }

      // Add event listeners
      document.addEventListener('DOMContentLoaded', function() {
        // Add click events to filter buttons
        document.querySelectorAll('.filter-btn').forEach((btn, index) => {
          const filters = ['Tümü', 'Bugün', 'Yarın', 'Bu Hafta', 'Müsait'];
          btn.addEventListener('click', () => filterMatches(filters[index], btn));
        });
        
        // Add click events to join buttons
        document.querySelectorAll('.btn-join').forEach(btn => {
          if (!btn.classList.contains('disabled')) {
            btn.addEventListener('click', () => {
              const matchCard = btn.closest('.match-card');
              const matchName = matchCard.querySelector('.match-title').textContent;
              const time = matchCard.querySelector('.match-time').textContent;
              joinMatch(btn, matchName, time);
            });
          }
        });
        
        // Add click events to match cards for details
        document.querySelectorAll('.match-card').forEach(card => {
          card.addEventListener('click', (e) => {
            // Don't trigger if clicking on join button
            if (!e.target.classList.contains('btn-join')) {
              viewMatchDetails(card);
            }
          });
          card.style.cursor = 'pointer';
        });
        
        // Add CSS animation
        const style = document.createElement('style');
        style.textContent = `
          @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
          }
        `;
        document.head.appendChild(style);
      });
    </script>

    <!-- Confirmation Modal -->
    <div id="confirmationModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <div class="modal-title" id="modalTitle">Emin misiniz?</div>
        </div>
        <div class="modal-message" id="modalMessage">Bu işlemi onaylamak istediğinizden emin misiniz?</div>
        <div class="modal-actions">
          <button class="modal-btn modal-btn-secondary" onclick="closeModal()">İptal</button>
          <button class="modal-btn modal-btn-primary" id="confirmBtn">Onayla</button>
        </div>
      </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>
  </body>
</html>
