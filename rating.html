<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Paslios - Oyuncu DeÄŸerlendirmesi">
    <link href="output.css" rel="stylesheet">
    <title>Paslios - Oyuncu DeÄŸerlendirmesi</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        background: #f9fafb;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
      }
      
      .header {
        background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
        padding: 3rem 1rem 2rem 1rem;
        width: 100vw;
        margin-left: calc(-50vw + 50%);
      }
      
      .header-container {
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
      }
      
      .nav {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1rem;
      }
      
      .back-btn {
        width: 2.5rem;
        height: 2.5rem;
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        text-decoration: none;
        transition: all 0.2s;
      }
      
      .back-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      
      .nav-center h1 {
        color: white;
        font-size: 1.25rem;
        font-weight: bold;
        text-align: center;
      }
      
      .nav-right {
        width: 2.5rem;
      }
      
      .match-info {
        background: rgba(255, 255, 255, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 16px;
        padding: 1rem;
        text-align: center;
        color: white;
      }
      
      .match-title {
        font-size: 1.125rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      
      .match-details {
        opacity: 0.9;
        font-size: 0.875rem;
      }
      
      .main-content {
        flex: 1;
        max-width: 400px;
        margin: 0 auto;
        width: 100%;
        padding: 1.5rem 1rem;
      }
      
      .instruction {
        background: #dbeafe;
        border: 1px solid #93c5fd;
        border-radius: 12px;
        padding: 1rem;
        margin-bottom: 2rem;
        text-align: center;
      }
      
      .instruction-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
      }
      
      .instruction-title {
        color: #1e40af;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      
      .instruction-text {
        color: #1e3a8a;
        font-size: 0.875rem;
      }
      
      .players-list {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .player-card {
        background: white;
        border-radius: 16px;
        padding: 1.5rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        border: 1px solid #f3f4f6;
      }
      
      .player-header {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 1rem;
      }
      
      .player-avatar {
        width: 3rem;
        height: 3rem;
        background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        color: #6b7280;
      }
      
      .player-info h3 {
        color: #1f2937;
        font-weight: bold;
        margin-bottom: 0.25rem;
      }
      
      .player-position {
        color: #6b7280;
        font-size: 0.875rem;
      }
      
      .rating-categories {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      
      .rating-category {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
      }
      
      .category-label {
        color: #374151;
        font-weight: 600;
        font-size: 0.875rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      
      .rating-buttons {
        display: flex;
        gap: 0.5rem;
      }
      
      .rating-btn {
        flex: 1;
        padding: 0.75rem;
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        background: white;
        color: #6b7280;
        font-size: 0.75rem;
        font-weight: 600;
        text-align: center;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .rating-btn:hover {
        border-color: #d1d5db;
        background: #f9fafb;
      }
      
      .rating-btn.selected {
        border-color: #3b82f6;
        background: #dbeafe;
        color: #1e40af;
      }
      
      .rating-btn.poor {
        border-color: #ef4444;
        background: #fee2e2;
        color: #dc2626;
      }
      
      .rating-btn.average {
        border-color: #f59e0b;
        background: #fef3c7;
        color: #d97706;
      }
      
      .rating-btn.good {
        border-color: #10b981;
        background: #d1fae5;
        color: #059669;
      }
      
      .submit-btn {
        background: linear-gradient(135deg, #3b82f6, #8b5cf6);
        color: white;
        border: none;
        border-radius: 12px;
        padding: 1rem 2rem;
        font-weight: bold;
        font-size: 1rem;
        width: 100%;
        margin-top: 2rem;
        cursor: pointer;
        transition: all 0.2s;
      }
      
      .submit-btn:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 16px rgba(59, 130, 246, 0.3);
      }
      
      .submit-btn:disabled {
        opacity: 0.5;
        cursor: not-allowed;
        transform: none;
        box-shadow: none;
      }
      
      .completion-message {
        text-align: center;
        padding: 2rem;
        background: white;
        border-radius: 16px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        margin-bottom: 2rem;
      }
      
      .completion-icon {
        font-size: 3rem;
        margin-bottom: 1rem;
      }
      
      .completion-title {
        color: #1f2937;
        font-size: 1.25rem;
        font-weight: bold;
        margin-bottom: 0.5rem;
      }
      
      .completion-text {
        color: #6b7280;
        margin-bottom: 1.5rem;
      }
      
      .return-btn {
        background: #f3f4f6;
        color: #374151;
        border: none;
        border-radius: 12px;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        text-decoration: none;
        display: inline-block;
        transition: all 0.2s;
      }
      
      .return-btn:hover {
        background: #e5e7eb;
      }
    </style>
  </head>
  <body>
    <!-- Header -->
    <div class="header">
      <div class="header-container">
        <!-- Navigation -->
        <div class="nav">
          <a href="notifications.html" class="back-btn">
            <span style="color: white; font-size: 1.125rem;">â†</span>
          </a>
          <div class="nav-center">
            <h1>Oyuncu DeÄŸerlendirmesi</h1>
          </div>
          <div class="nav-right"></div>
        </div>

        <!-- Match Info -->
        <div class="match-info">
          <div class="match-title">Ankara Spor HalÄ±saha</div>
          <div class="match-details">28 Ocak 2025 â€¢ 20:00 â€¢ TakÄ±m MaÃ§Ä±</div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Instruction -->
      <div class="instruction">
        <div class="instruction-icon">â­</div>
        <div class="instruction-title">OyuncularÄ± DeÄŸerlendir</div>
        <div class="instruction-text">
          MaÃ§ta birlikte oynadÄ±ÄŸÄ±n oyuncularÄ± aÅŸaÄŸÄ±daki kategorilerde deÄŸerlendir. Bu deÄŸerlendirmeler oyuncularÄ±n profillerinde gÃ¶rÃ¼necek.
        </div>
      </div>

      <!-- Players List -->
      <div class="players-list" id="playersList">
        <!-- Player 1 -->
        <div class="player-card" data-player="mehmet">
          <div class="player-header">
            <div class="player-avatar">MK</div>
            <div class="player-info">
              <h3>Mehmet Kaya</h3>
              <div class="player-position">Kaleci</div>
            </div>
          </div>
          
          <div class="rating-categories">
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ¤</span>
                <span>TakÄ±m Oyuncusu</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="teamwork" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="teamwork" data-value="average">Orta</button>
                <button class="rating-btn" data-category="teamwork" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>âš½</span>
                <span>Yetenekli</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="skill" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="skill" data-value="average">Orta</button>
                <button class="rating-btn" data-category="skill" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ™</span>
                <span>SaygÄ±lÄ±</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="respect" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="respect" data-value="average">Orta</button>
                <button class="rating-btn" data-category="respect" data-value="good">Ä°yi</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Player 2 -->
        <div class="player-card" data-player="emre">
          <div class="player-header">
            <div class="player-avatar">ED</div>
            <div class="player-info">
              <h3>Emre Demir</h3>
              <div class="player-position">Forvet</div>
            </div>
          </div>
          
          <div class="rating-categories">
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ¤</span>
                <span>TakÄ±m Oyuncusu</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="teamwork" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="teamwork" data-value="average">Orta</button>
                <button class="rating-btn" data-category="teamwork" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>âš½</span>
                <span>Yetenekli</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="skill" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="skill" data-value="average">Orta</button>
                <button class="rating-btn" data-category="skill" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ™</span>
                <span>SaygÄ±lÄ±</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="respect" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="respect" data-value="average">Orta</button>
                <button class="rating-btn" data-category="respect" data-value="good">Ä°yi</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Player 3 -->
        <div class="player-card" data-player="can">
          <div class="player-header">
            <div class="player-avatar">CÃ–</div>
            <div class="player-info">
              <h3>Can Ã–zkan</h3>
              <div class="player-position">Defans</div>
            </div>
          </div>
          
          <div class="rating-categories">
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ¤</span>
                <span>TakÄ±m Oyuncusu</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="teamwork" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="teamwork" data-value="average">Orta</button>
                <button class="rating-btn" data-category="teamwork" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>âš½</span>
                <span>Yetenekli</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="skill" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="skill" data-value="average">Orta</button>
                <button class="rating-btn" data-category="skill" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ™</span>
                <span>SaygÄ±lÄ±</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="respect" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="respect" data-value="average">Orta</button>
                <button class="rating-btn" data-category="respect" data-value="good">Ä°yi</button>
              </div>
            </div>
          </div>
        </div>

        <!-- Player 4 -->
        <div class="player-card" data-player="burak">
          <div class="player-header">
            <div class="player-avatar">BT</div>
            <div class="player-info">
              <h3>Burak TunÃ§</h3>
              <div class="player-position">Orta Saha</div>
            </div>
          </div>
          
          <div class="rating-categories">
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ¤</span>
                <span>TakÄ±m Oyuncusu</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="teamwork" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="teamwork" data-value="average">Orta</button>
                <button class="rating-btn" data-category="teamwork" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>âš½</span>
                <span>Yetenekli</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="skill" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="skill" data-value="average">Orta</button>
                <button class="rating-btn" data-category="skill" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ™</span>
                <span>SaygÄ±lÄ±</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="respect" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="respect" data-value="average">Orta</button>
                <button class="rating-btn" data-category="respect" data-value="good">Ä°yi</button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Submit Button -->
      <button class="submit-btn" id="submitBtn" onclick="submitRatings()">
        DeÄŸerlendirmeleri GÃ¶nder
      </button>

      <!-- Completion Message (Hidden initially) -->
      <div class="completion-message" id="completionMessage" style="display: none;">
        <div class="completion-icon">âœ…</div>
        <div class="completion-title">DeÄŸerlendirmeler GÃ¶nderildi!</div>
        <div class="completion-text">
          OyuncularÄ± deÄŸerlendirdiÄŸin iÃ§in teÅŸekkÃ¼rler. Bu deÄŸerlendirmeler diÄŸer oyuncularÄ±n profil puanlarÄ±na yansÄ±yacak.
        </div>
        <a href="home.html" class="return-btn">Ana Sayfaya DÃ¶n</a>
      </div>
    </div>

    <!-- Include Data Management System -->
    <script src="js/data.js"></script>
    
    <script>
      // Authentication check - redirect if not logged in
      if (!PasliosData.isAuthenticated()) {
        window.location.href = 'index.html';
      }

      let currentUser = PasliosData.getCurrentUser();
      let currentMatch = null;
      let matchPlayers = [];
      let ratings = {};

      // Get match ID from URL parameters
      const urlParams = new URLSearchParams(window.location.search);
      const matchId = urlParams.get('matchId');

      // Initialize page
      document.addEventListener('DOMContentLoaded', function() {
        if (matchId) {
          loadMatchData();
        } else {
          // Show recent matches to rate
          showRecentMatches();
        }
      });

      function loadMatchData() {
        currentMatch = PasliosData.getMatch(matchId);
        if (!currentMatch) {
          showToast('MaÃ§ bulunamadÄ±!', 'error');
          return;
        }

        // Check if user participated in this match
        const userParticipated = currentMatch.participants?.includes(currentUser.id) ||
                                 currentMatch.teamParticipants?.[currentUser.teamId]?.includes(currentUser.id);

        if (!userParticipated) {
          showToast('Bu maÃ§a katÄ±lmadÄ±ÄŸÄ±nÄ±z iÃ§in deÄŸerlendirme yapamazsÄ±nÄ±z!', 'error');
          return;
        }

        // Check if user already rated this match
        const existingRating = PasliosData.getUserRating(currentUser.id, matchId);
        if (existingRating) {
          showCompletionMessage(true);
          return;
        }

        // Load match info in header
        updateMatchHeader();
        
        // Load players who participated in this match
        loadMatchPlayers();
        
        // Initialize ratings object
        initializeRatings();
      }

      function updateMatchHeader() {
        const venue = PasliosData.getVenue(currentMatch.venueId);
        const matchDate = new Date(currentMatch.date);
        
        document.querySelector('.match-title').textContent = venue?.name || 'MaÃ§';
        document.querySelector('.match-details').textContent = 
          `${matchDate.toLocaleDateString('tr-TR')} â€¢ ${matchDate.toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'})} â€¢ ${currentMatch.type === 'team' ? 'TakÄ±m MaÃ§Ä±' : 'Bireysel MaÃ§'}`;
      }

      function loadMatchPlayers() {
        matchPlayers = [];
        
        if (currentMatch.type === 'individual') {
          // Individual match - load other participants
          currentMatch.participants?.forEach(playerId => {
            if (playerId !== currentUser.id) {
              const player = PasliosData.getUser(playerId);
              if (player) {
                matchPlayers.push({
                  id: playerId,
                  name: player.name,
                  position: player.position || 'Oyuncu',
                  avatar: player.name.split(' ').map(n => n[0]).join('').toUpperCase()
                });
              }
            }
          });
        } else if (currentMatch.type === 'team') {
          // Team match - load team members who participated
          const userTeam = PasliosData.getTeam(currentUser.teamId);
          if (userTeam) {
            const teamParticipants = currentMatch.teamParticipants?.[userTeam.id] || [];
            teamParticipants.forEach(playerId => {
              if (playerId !== currentUser.id) {
                const player = PasliosData.getUser(playerId);
                if (player) {
                  matchPlayers.push({
                    id: playerId,
                    name: player.name,
                    position: player.position || 'Oyuncu',
                    avatar: player.name.split(' ').map(n => n[0]).join('').toUpperCase()
                  });
                }
              }
            });
          }
        }

        if (matchPlayers.length === 0) {
          document.getElementById('playersList').innerHTML = `
            <div style="text-align: center; padding: 3rem 1rem; color: #6b7280;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">â­</div>
              <div style="font-weight: 600; margin-bottom: 0.5rem;">DeÄŸerlendirilecek oyuncu yok</div>
              <div style="font-size: 0.875rem;">Bu maÃ§ta sizinle beraber oynayan baÅŸka oyuncu bulunmuyor.</div>
            </div>
          `;
          document.getElementById('submitBtn').style.display = 'none';
          return;
        }

        renderPlayers();
      }

      function renderPlayers() {
        const playersList = document.getElementById('playersList');
        playersList.innerHTML = '';

        matchPlayers.forEach(player => {
          const playerCard = createPlayerCard(player);
          playersList.appendChild(playerCard);
        });
      }

      function createPlayerCard(player) {
        const playerCard = document.createElement('div');
        playerCard.className = 'player-card';
        playerCard.dataset.player = player.id;

        playerCard.innerHTML = `
          <div class="player-header">
            <div class="player-avatar">${player.avatar}</div>
            <div class="player-info">
              <h3>${player.name}</h3>
              <div class="player-position">${player.position}</div>
            </div>
          </div>
          
          <div class="rating-categories">
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ¤</span>
                <span>TakÄ±m Oyuncusu</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="teamwork" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="teamwork" data-value="average">Orta</button>
                <button class="rating-btn" data-category="teamwork" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>âš½</span>
                <span>Yetenekli</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="skill" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="skill" data-value="average">Orta</button>
                <button class="rating-btn" data-category="skill" data-value="good">Ä°yi</button>
              </div>
            </div>
            
            <div class="rating-category">
              <div class="category-label">
                <span>ğŸ™</span>
                <span>SaygÄ±lÄ±</span>
              </div>
              <div class="rating-buttons">
                <button class="rating-btn" data-category="respect" data-value="poor">ZayÄ±f</button>
                <button class="rating-btn" data-category="respect" data-value="average">Orta</button>
                <button class="rating-btn" data-category="respect" data-value="good">Ä°yi</button>
              </div>
            </div>
          </div>
        `;

        return playerCard;
      }

      function initializeRatings() {
        const categories = ['teamwork', 'skill', 'respect'];
        
        matchPlayers.forEach(player => {
          ratings[player.id] = {};
          categories.forEach(category => {
            ratings[player.id][category] = null;
          });
        });
      }

      function showRecentMatches() {
        const recentMatches = PasliosData.getUserMatches(currentUser.id)
          .filter(match => {
            // Show completed matches that haven't been rated yet
            const completedRecently = new Date(match.date) < new Date() && 
                                    new Date() - new Date(match.date) < 7 * 24 * 60 * 60 * 1000; // Last 7 days
            const notRated = !PasliosData.getUserRating(currentUser.id, match.id);
            return completedRecently && notRated;
          })
          .sort((a, b) => new Date(b.date) - new Date(a.date));

        if (recentMatches.length === 0) {
          document.querySelector('.main-content').innerHTML = `
            <div style="text-align: center; padding: 3rem 1rem; color: #6b7280;">
              <div style="font-size: 3rem; margin-bottom: 1rem;">â­</div>
              <div style="font-weight: 600; margin-bottom: 0.5rem;">DeÄŸerlendirilecek maÃ§ yok</div>
              <div style="font-size: 0.875rem; margin-bottom: 1.5rem;">Son 7 gÃ¼n iÃ§inde tamamlanan maÃ§Ä±nÄ±z bulunmuyor.</div>
              <a href="matches.html" style="background: #10b981; color: white; padding: 12px 24px; border-radius: 8px; text-decoration: none; font-weight: 600;">
                Yeni MaÃ§ Bul
              </a>
            </div>
          `;
          return;
        }

        // Update header
        document.querySelector('.match-title').textContent = 'Son MaÃ§larÄ±nÄ±z';
        document.querySelector('.match-details').textContent = 'DeÄŸerlendirme bekleyen maÃ§lar';

        // Show match selection
        const playersList = document.getElementById('playersList');
        playersList.innerHTML = `
          <div class="instruction">
            <div class="instruction-icon">ğŸ“‹</div>
            <div class="instruction-title">Hangi MaÃ§Ä± DeÄŸerlendireceksiniz?</div>
            <div class="instruction-text">
              Son 7 gÃ¼n iÃ§inde oynadÄ±ÄŸÄ±nÄ±z maÃ§lardan birini seÃ§in ve oyuncularÄ± deÄŸerlendirin.
            </div>
          </div>
          
          ${recentMatches.map(match => {
            const venue = PasliosData.getVenue(match.venueId);
            const matchDate = new Date(match.date);
            return `
              <div class="match-selection-card" onclick="selectMatch('${match.id}')" style="background: white; border-radius: 12px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; transition: all 0.2s;">
                <div style="font-weight: 600; margin-bottom: 0.5rem;">${venue?.name || 'MaÃ§'}</div>
                <div style="color: #6b7280; font-size: 0.875rem; margin-bottom: 0.5rem;">
                  ${matchDate.toLocaleDateString('tr-TR')} â€¢ ${matchDate.toLocaleTimeString('tr-TR', {hour: '2-digit', minute: '2-digit'})}
                </div>
                <div style="color: #10b981; font-size: 0.875rem; font-weight: 600;">
                  ${match.type === 'team' ? 'ğŸ† TakÄ±m MaÃ§Ä±' : 'âš½ Bireysel MaÃ§'} â€¢ DeÄŸerlendirme Bekliyor
                </div>
              </div>
            `;
          }).join('')}
        `;

        document.getElementById('submitBtn').style.display = 'none';
      }

      function selectMatch(selectedMatchId) {
        // Reload page with selected match
        window.location.href = `rating.html?matchId=${selectedMatchId}`;
      }

      // Handle rating button clicks
      document.addEventListener('click', function(e) {
        if (e.target.classList.contains('rating-btn')) {
          const playerCard = e.target.closest('.player-card');
          const playerId = playerCard.dataset.player;
          const category = e.target.dataset.category;
          const value = e.target.dataset.value;
          
          // Remove selected class from all buttons in this category
          const categoryButtons = playerCard.querySelectorAll(`[data-category="${category}"]`);
          categoryButtons.forEach(btn => {
            btn.classList.remove('selected', 'poor', 'average', 'good');
          });
          
          // Add selected class and color class to clicked button
          e.target.classList.add('selected', value);
          
          // Store the rating
          if (!ratings[playerId]) {
            ratings[playerId] = {};
          }
          ratings[playerId][category] = value;
          
          // Check if all ratings are complete
          updateSubmitButton();
        }
      });

      function updateSubmitButton() {
        const submitBtn = document.getElementById('submitBtn');
        if (!submitBtn) return;

        let allRatingsComplete = true;
        const categories = ['teamwork', 'skill', 'respect'];
        
        matchPlayers.forEach(player => {
          categories.forEach(category => {
            if (!ratings[player.id] || ratings[player.id][category] === null) {
              allRatingsComplete = false;
            }
          });
        });
        
        submitBtn.disabled = !allRatingsComplete;
        if (allRatingsComplete) {
          submitBtn.textContent = 'âœ… DeÄŸerlendirmeleri GÃ¶nder';
          submitBtn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
        } else {
          submitBtn.textContent = `ğŸ“ ${getRatingProgress()} deÄŸerlendirme tamamlandÄ±`;
          submitBtn.style.background = 'linear-gradient(135deg, #6b7280, #4b5563)';
        }
      }

      function getRatingProgress() {
        let completed = 0;
        const total = matchPlayers.length * 3; // 3 categories per player
        const categories = ['teamwork', 'skill', 'respect'];
        
        matchPlayers.forEach(player => {
          categories.forEach(category => {
            if (ratings[player.id] && ratings[player.id][category] !== null) {
              completed++;
            }
          });
        });
        
        return `${completed}/${total}`;
      }

      function submitRatings() {
        if (!currentMatch) return;

        // Convert ratings to numeric values for storage
        const numericRatings = {};
        const valueMap = { poor: 1, average: 3, good: 5 };
        
        Object.keys(ratings).forEach(playerId => {
          numericRatings[playerId] = {};
          Object.keys(ratings[playerId]).forEach(category => {
            numericRatings[playerId][category] = valueMap[ratings[playerId][category]];
          });
        });

        // Create rating data
        const ratingData = {
          raterId: currentUser.id,
          matchId: currentMatch.id,
          matchDate: currentMatch.date,
          ratings: numericRatings,
          submittedAt: new Date().toISOString()
        };

        // Save rating
        PasliosData.createRating(ratingData);

        // Update player stats
        Object.keys(numericRatings).forEach(playerId => {
          const playerRating = numericRatings[playerId];
          const avgRating = (playerRating.teamwork + playerRating.skill + playerRating.respect) / 3;
          PasliosData.updatePlayerRating(playerId, avgRating);
        });

        // Show completion message
        showCompletionMessage(false);
        
        // Scroll to top
        window.scrollTo(0, 0);
      }

      function showCompletionMessage(alreadyRated = false) {
        // Hide the form and show completion message
        document.getElementById('playersList').style.display = 'none';
        const submitBtn = document.getElementById('submitBtn');
        if (submitBtn) submitBtn.style.display = 'none';
        
        document.getElementById('completionMessage').style.display = 'block';
        
        if (alreadyRated) {
          document.querySelector('.completion-title').textContent = 'Zaten DeÄŸerlendirildi';
          document.querySelector('.completion-text').textContent = 'Bu maÃ§ iÃ§in daha Ã¶nce deÄŸerlendirme yapmÄ±ÅŸsÄ±nÄ±z.';
          document.querySelector('.completion-icon').textContent = 'âœ…';
        }
      }

      function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
          color: white;
          padding: 12px 20px;
          border-radius: 12px;
          font-weight: 600;
          z-index: 9999;
          opacity: 0;
          transform: translateX(100%);
          transition: all 0.3s ease;
          max-width: 300px;
        `;
        toast.textContent = message;
        
        document.body.appendChild(toast);
        
        // Show toast
        setTimeout(() => {
          toast.style.opacity = '1';
          toast.style.transform = 'translateX(0)';
        }, 100);
        
        // Hide and remove toast
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateX(100%)';
          setTimeout(() => toast.remove(), 300);
        }, 3000);
      }
    </script>
  </body>
</html>
