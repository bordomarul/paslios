<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>İnteraksiyon Güvenlik Testi - Paslios</title>
    <link href="output.css" rel="stylesheet">`n    <link href="css/responsive.css" rel="stylesheet">
    <style>
        .test-result {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            max-height: 500px;
            overflow-y: auto;
        }
        .test-button {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        }
        .api-button {
            background: linear-gradient(45deg, #FF9800, #F57C00);
        }
        .api-button:hover {
            box-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);
        }
        .test-info {
            background: #f0f8ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .api-example {
            background: #fff3e0;
            border-left: 4px solid #FF9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">💬 Post İnteraksiyon Güvenlik Testleri</h1>
                <p class="text-lg text-gray-600">Yorum ve beğeni sistemlerinin güvenlik kontrollerini test edin</p>
            </div>

            <!-- Test Info -->
            <div class="test-info">
                <h3 class="font-bold text-lg mb-2">📋 Test Edilen Güvenlik Kontrolleri:</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <h4 class="font-semibold text-blue-600 mb-2">🗨️ Yorum Sistemi:</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>Yorum-post ilişkilendirme</li>
                            <li>Boş yorum engelleme</li>
                            <li>Spam/flood kontrolü</li>
                            <li>XSS saldırı koruması</li>
                            <li>İçerik sanitizasyonu</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-blue-600 mb-2">❤️ Beğeni Sistemi:</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>Tekrarlı beğeni engelleme</li>
                            <li>Self-like engelleme</li>
                            <li>Beğeni durumu feedback</li>
                            <li>Real-time like count</li>
                            <li>Geçersiz ID handling</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- API Examples -->
            <div class="api-example">
                <h3 class="font-bold text-lg mb-2">🔌 API Endpoint Örnekleri:</h3>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-orange-600">POST /api/posts/:postId/comments</h4>
                        <div class="code-block">
{
  "text": "Harika bir gönderi!"
}</div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-orange-600">POST /api/posts/:postId/like</h4>
                        <div class="code-block">
// Body gerekmez, toggle işlemi yapar</div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-orange-600">GET /api/posts/:postId/like-status</h4>
                        <div class="code-block">
{
  "isLiked": true,
  "likeCount": 15
}</div>
                    </div>
                </div>
            </div>

            <!-- Test Buttons -->
            <div class="text-center mb-6">
                <button onclick="runTests()" class="test-button">
                    🚀 Tüm Güvenlik Testlerini Çalıştır
                </button>
                <button onclick="testCommentAPI()" class="test-button api-button">
                    💬 Yorum API Testi
                </button>
                <button onclick="testLikeAPI()" class="test-button api-button">
                    ❤️ Beğeni API Testi
                </button>
            </div>

            <!-- Test Results -->
            <div id="testResults" class="test-result" style="display: none;">
                <div id="testOutput"></div>
            </div>

            <!-- Manual Test Areas -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
                <!-- Comment Test -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-bold mb-4">💬 Manuel Yorum Testi</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Post ID:</label>
                            <input type="number" id="commentPostId" class="w-full p-3 border border-gray-300 rounded-lg" 
                                   placeholder="888888" value="888888">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Yorum İçeriği:</label>
                            <textarea id="commentText" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" 
                                      placeholder="Yorumunuzu buraya yazın..."></textarea>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="testComment()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex-1">
                                Yorum Ekle
                            </button>
                            <button onclick="loadXSSComment()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                                XSS Test
                            </button>
                        </div>
                        
                        <div id="commentResult" class="mt-4 p-4 rounded-lg" style="display: none;"></div>
                    </div>
                </div>

                <!-- Like Test -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-bold mb-4">❤️ Manuel Beğeni Testi</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Post ID:</label>
                            <input type="number" id="likePostId" class="w-full p-3 border border-gray-300 rounded-lg" 
                                   placeholder="888888" value="888888">
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="testLike()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 flex-1">
                                ❤️ Beğeni Toggle
                            </button>
                            <button onclick="checkLikeStatus()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                                📊 Durum
                            </button>
                        </div>
                        
                        <div id="likeResult" class="mt-4 p-4 rounded-lg" style="display: none;"></div>
                        
                        <div id="likeStatus" class="mt-4 p-4 bg-gray-100 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">Beğeni Durumu:</span>
                                <span id="likeStatusText" class="text-gray-500">Bilinmiyor</span>
                            </div>
                            <div class="flex justify-between items-center mt-2">
                                <span class="font-medium">Toplam Beğeni:</span>
                                <span id="likeCountText" class="text-blue-600 font-bold">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flood Test Area -->
            <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
                <h3 class="text-xl font-bold mb-4">🌊 Spam/Flood Test Alanı</h3>
                <p class="text-gray-600 mb-4">Hızlı ardışık işlemlerle spam kontrolünü test edin:</p>
                
                <div class="flex space-x-4">
                    <button onclick="floodTestComments()" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600">
                        💬 10 Hızlı Yorum
                    </button>
                    <button onclick="floodTestLikes()" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600">
                        ❤️ 20 Hızlı Beğeni
                    </button>
                    <button onclick="duplicateCommentTest()" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600">
                        🔄 Aynı Yorum x5
                    </button>
                </div>
                
                <div id="floodResult" class="mt-4 p-4 rounded-lg" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/data.js"></script>
    <script src="js/interaction-security-test.js"></script>
    
    <script>
        // Console override
        const originalLog = console.log;
        let testOutput = '';
        
        function runTests() {
            const resultsDiv = document.getElementById('testResults');
            const outputDiv = document.getElementById('testOutput');
            
            testOutput = '';
            
            console.log = function(...args) {
                const message = args.join(' ');
                testOutput += message + '\n';
                outputDiv.innerHTML = testOutput.replace(/\n/g, '<br>');
                originalLog.apply(console, args);
            };
            
            resultsDiv.style.display = 'block';
            outputDiv.innerHTML = 'Testler başlatılıyor...<br>';
            
            setTimeout(() => {
                runInteractionSecurityTests();
                setTimeout(() => {
                    console.log = originalLog;
                }, 1000);
            }, 100);
        }
        
        function createTestEnvironment() {
            if (!localStorage.getItem('paslios_currentUser')) {
                const testUser = {
                    id: 999999,
                    name: 'Test User',
                    email: 'test@test.com',
                    avatar: '/images/default-avatar.png'
                };
                localStorage.setItem('paslios_currentUser', JSON.stringify(testUser));
            }
            
            const pasliosData = new PasliosData();
            const posts = pasliosData.getData('posts');
            const testPostExists = posts.find(p => p.id === 888888);
            
            if (!testPostExists) {
                const testPost = {
                    id: 888888,
                    authorId: 777777, // Farklı kullanıcı ID
                    authorName: 'Other User',
                    content: 'Test gönderisi',
                    type: 'text',
                    timestamp: new Date().toISOString(),
                    likedBy: [],
                    comments: []
                };
                posts.unshift(testPost);
                pasliosData.setData('posts', posts);
            }
        }
        
        function testComment() {
            createTestEnvironment();
            
            const postId = parseInt(document.getElementById('commentPostId').value);
            const text = document.getElementById('commentText').value;
            const resultDiv = document.getElementById('commentResult');
            
            const result = API.addComment(postId, { text: text });
            
            resultDiv.style.display = 'block';
            if (result.success) {
                resultDiv.className = 'mt-4 p-4 rounded-lg bg-green-100 border border-green-400';
                resultDiv.innerHTML = `
                    <strong>✅ Yorum Başarıyla Eklendi!</strong><br>
                    <strong>ID:</strong> ${result.comment.id}<br>
                    <strong>İçerik:</strong> ${result.comment.content}<br>
                    <strong>Zaman:</strong> ${result.comment.timestamp}
                `;
            } else {
                resultDiv.className = 'mt-4 p-4 rounded-lg bg-red-100 border border-red-400';
                resultDiv.innerHTML = `
                    <strong>❌ Yorum Eklenemedi!</strong><br>
                    <strong>Hata:</strong> ${result.message}
                `;
            }
        }
        
        function testLike() {
            createTestEnvironment();
            
            const postId = parseInt(document.getElementById('likePostId').value);
            const result = API.toggleLike(postId);
            const resultDiv = document.getElementById('likeResult');
            
            resultDiv.style.display = 'block';
            if (result.success) {
                resultDiv.className = 'mt-4 p-4 rounded-lg bg-green-100 border border-green-400';
                resultDiv.innerHTML = `
                    <strong>✅ ${result.message}</strong><br>
                    <strong>Beğeni Durumu:</strong> ${result.isLiked ? 'Beğenildi' : 'Beğeni Kaldırıldı'}<br>
                    <strong>Toplam Beğeni:</strong> ${result.likeCount}
                `;
                updateLikeStatus();
            } else {
                resultDiv.className = 'mt-4 p-4 rounded-lg bg-red-100 border border-red-400';
                resultDiv.innerHTML = `
                    <strong>❌ İşlem Başarısız!</strong><br>
                    <strong>Hata:</strong> ${result.message}
                `;
            }
        }
        
        function checkLikeStatus() {
            createTestEnvironment();
            updateLikeStatus();
        }
        
        function updateLikeStatus() {
            const postId = parseInt(document.getElementById('likePostId').value);
            const status = API.getLikeStatus(postId);
            
            document.getElementById('likeStatusText').textContent = status.isLiked ? '❤️ Beğenildi' : '🤍 Beğenilmedi';
            document.getElementById('likeCountText').textContent = status.likeCount;
        }
        
        function loadXSSComment() {
            document.getElementById('commentText').value = `<script>alert("XSS Attack!")</script>`;
        }
        
        function floodTestComments() {
            createTestEnvironment();
            const resultDiv = document.getElementById('floodResult');
            const postId = 888888;
            
            let successCount = 0;
            let blockedCount = 0;
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'mt-4 p-4 rounded-lg bg-blue-100 border border-blue-400';
            resultDiv.innerHTML = 'Flood test başlatılıyor...';
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const result = API.addComment(postId, { text: `Flood test yorumu ${i + 1}` });
                    if (result.success) successCount++;
                    else blockedCount++;
                    
                    if (i === 9) {
                        resultDiv.innerHTML = `
                            <strong>🌊 Flood Test Tamamlandı</strong><br>
                            <strong>Başarılı Yorumlar:</strong> ${successCount}<br>
                            <strong>Engellenen Yorumlar:</strong> ${blockedCount}<br>
                            <strong>Sonuç:</strong> ${blockedCount > 5 ? '✅ Flood koruması çalışıyor' : '❌ Flood koruması yetersiz'}
                        `;
                    }
                }, i * 100);
            }
        }
        
        function floodTestLikes() {
            createTestEnvironment();
            const resultDiv = document.getElementById('floodResult');
            const postId = 888888;
            
            let operations = 0;
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'mt-4 p-4 rounded-lg bg-blue-100 border border-blue-400';
            resultDiv.innerHTML = 'Like flood test başlatılıyor...';
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    API.toggleLike(postId);
                    operations++;
                    
                    if (i === 19) {
                        const finalStatus = API.getLikeStatus(postId);
                        resultDiv.innerHTML = `
                            <strong>❤️ Like Flood Test Tamamlandı</strong><br>
                            <strong>Toplam İşlem:</strong> ${operations}<br>
                            <strong>Final Durum:</strong> ${finalStatus.isLiked ? 'Beğenildi' : 'Beğenilmedi'}<br>
                            <strong>Like Count:</strong> ${finalStatus.likeCount}<br>
                            <strong>Sonuç:</strong> ${finalStatus.likeCount <= 1 ? '✅ Toggle sistemi çalışıyor' : '❌ Duplicate like problemi'}
                        `;
                    }
                }, i * 50);
            }
        }
        
        function duplicateCommentTest() {
            createTestEnvironment();
            const resultDiv = document.getElementById('floodResult');
            const postId = 888888;
            const duplicateText = 'Bu tekrarlanan test yorumudur';
            
            let successCount = 0;
            let blockedCount = 0;
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'mt-4 p-4 rounded-lg bg-blue-100 border border-blue-400';
            resultDiv.innerHTML = 'Duplicate comment test başlatılıyor...';
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const result = API.addComment(postId, { text: duplicateText });
                    if (result.success) successCount++;
                    else blockedCount++;
                    
                    if (i === 4) {
                        resultDiv.innerHTML = `
                            <strong>🔄 Duplicate Comment Test Tamamlandı</strong><br>
                            <strong>Başarılı Yorumlar:</strong> ${successCount}<br>
                            <strong>Engellenen Yorumlar:</strong> ${blockedCount}<br>
                            <strong>Sonuç:</strong> ${successCount === 1 && blockedCount === 4 ? '✅ Duplicate engelleme çalışıyor' : '❌ Duplicate engelleme problemi'}
                        `;
                    }
                }, i * 200);
            }
        }
        
        function testCommentAPI() {
            createTestEnvironment();
            
            console.log('🔌 Comment API Test Başlatılıyor...');
            
            // API simulation test
            const testCases = [
                { postId: 888888, text: 'Normal yorum testi' },
                { postId: 888888, text: '' },
                { postId: 999999, text: 'Geçersiz post ID' },
                { postId: 888888, text: '<script>alert("XSS")</script>' }
            ];
            
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    const result = API.addComment(testCase.postId, { text: testCase.text });
                    console.log(`Test ${index + 1}: ${result.success ? '✅ BAŞARILI' : '❌ BAŞARISIZ'} - ${result.message || 'OK'}`);
                }, index * 100);
            });
        }
        
        function testLikeAPI() {
            createTestEnvironment();
            
            console.log('🔌 Like API Test Başlatılıyor...');
            
            const testPostId = 888888;
            
            // İlk beğeni
            setTimeout(() => {
                const result1 = API.toggleLike(testPostId);
                console.log(`Beğeni Ekleme: ${result1.success ? '✅ BAŞARILI' : '❌ BAŞARISIZ'} - ${result1.message}`);
                
                // Durum kontrolü
                const status1 = API.getLikeStatus(testPostId);
                console.log(`Durum Kontrolü: Beğenildi: ${status1.isLiked}, Count: ${status1.likeCount}`);
                
                // Beğeniyi kaldırma
                setTimeout(() => {
                    const result2 = API.toggleLike(testPostId);
                    console.log(`Beğeni Kaldırma: ${result2.success ? '✅ BAŞARILI' : '❌ BAŞARISIZ'} - ${result2.message}`);
                    
                    const status2 = API.getLikeStatus(testPostId);
                    console.log(`Final Durum: Beğenildi: ${status2.isLiked}, Count: ${status2.likeCount}`);
                }, 100);
            }, 100);
        }
        
        // Sayfa yüklendiğinde
        document.addEventListener('DOMContentLoaded', () => {
            console.log('🔒 Post interaksiyon güvenlik test sistemi hazır!');
            updateLikeStatus();
        });
    </script>
</body>
</html>