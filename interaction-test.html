<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ä°nteraksiyon GÃ¼venlik Testi - Paslios</title>
    <link href="output.css" rel="stylesheet">`n    <link href="css/responsive.css" rel="stylesheet">
    <style>
        .test-result {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            max-height: 500px;
            overflow-y: auto;
        }
        .test-button {
            background: linear-gradient(45deg, #2196F3, #1976D2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            margin: 5px;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(33, 150, 243, 0.3);
        }
        .api-button {
            background: linear-gradient(45deg, #FF9800, #F57C00);
        }
        .api-button:hover {
            box-shadow: 0 4px 8px rgba(255, 152, 0, 0.3);
        }
        .test-info {
            background: #f0f8ff;
            border-left: 4px solid #2196F3;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .api-example {
            background: #fff3e0;
            border-left: 4px solid #FF9800;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }
        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
            margin: 10px 0;
            font-family: 'Courier New', monospace;
            overflow-x: auto;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-4xl mx-auto">
            <!-- Header -->
            <div class="text-center mb-8">
                <h1 class="text-4xl font-bold text-gray-800 mb-4">ğŸ’¬ Post Ä°nteraksiyon GÃ¼venlik Testleri</h1>
                <p class="text-lg text-gray-600">Yorum ve beÄŸeni sistemlerinin gÃ¼venlik kontrollerini test edin</p>
            </div>

            <!-- Test Info -->
            <div class="test-info">
                <h3 class="font-bold text-lg mb-2">ğŸ“‹ Test Edilen GÃ¼venlik Kontrolleri:</h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-4">
                    <div>
                        <h4 class="font-semibold text-blue-600 mb-2">ğŸ—¨ï¸ Yorum Sistemi:</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>Yorum-post iliÅŸkilendirme</li>
                            <li>BoÅŸ yorum engelleme</li>
                            <li>Spam/flood kontrolÃ¼</li>
                            <li>XSS saldÄ±rÄ± korumasÄ±</li>
                            <li>Ä°Ã§erik sanitizasyonu</li>
                        </ul>
                    </div>
                    <div>
                        <h4 class="font-semibold text-blue-600 mb-2">â¤ï¸ BeÄŸeni Sistemi:</h4>
                        <ul class="list-disc list-inside space-y-1 text-sm text-gray-700">
                            <li>TekrarlÄ± beÄŸeni engelleme</li>
                            <li>Self-like engelleme</li>
                            <li>BeÄŸeni durumu feedback</li>
                            <li>Real-time like count</li>
                            <li>GeÃ§ersiz ID handling</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- API Examples -->
            <div class="api-example">
                <h3 class="font-bold text-lg mb-2">ğŸ”Œ API Endpoint Ã–rnekleri:</h3>
                <div class="space-y-4">
                    <div>
                        <h4 class="font-semibold text-orange-600">POST /api/posts/:postId/comments</h4>
                        <div class="code-block">
{
  "text": "Harika bir gÃ¶nderi!"
}</div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-orange-600">POST /api/posts/:postId/like</h4>
                        <div class="code-block">
// Body gerekmez, toggle iÅŸlemi yapar</div>
                    </div>
                    <div>
                        <h4 class="font-semibold text-orange-600">GET /api/posts/:postId/like-status</h4>
                        <div class="code-block">
{
  "isLiked": true,
  "likeCount": 15
}</div>
                    </div>
                </div>
            </div>

            <!-- Test Buttons -->
            <div class="text-center mb-6">
                <button onclick="runTests()" class="test-button">
                    ğŸš€ TÃ¼m GÃ¼venlik Testlerini Ã‡alÄ±ÅŸtÄ±r
                </button>
                <button onclick="testCommentAPI()" class="test-button api-button">
                    ğŸ’¬ Yorum API Testi
                </button>
                <button onclick="testLikeAPI()" class="test-button api-button">
                    â¤ï¸ BeÄŸeni API Testi
                </button>
            </div>

            <!-- Test Results -->
            <div id="testResults" class="test-result" style="display: none;">
                <div id="testOutput"></div>
            </div>

            <!-- Manual Test Areas -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-8">
                <!-- Comment Test -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-bold mb-4">ğŸ’¬ Manuel Yorum Testi</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Post ID:</label>
                            <input type="number" id="commentPostId" class="w-full p-3 border border-gray-300 rounded-lg" 
                                   placeholder="888888" value="888888">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Yorum Ä°Ã§eriÄŸi:</label>
                            <textarea id="commentText" class="w-full p-3 border border-gray-300 rounded-lg" rows="3" 
                                      placeholder="Yorumunuzu buraya yazÄ±n..."></textarea>
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="testComment()" class="bg-blue-500 text-white px-4 py-2 rounded-lg hover:bg-blue-600 flex-1">
                                Yorum Ekle
                            </button>
                            <button onclick="loadXSSComment()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600">
                                XSS Test
                            </button>
                        </div>
                        
                        <div id="commentResult" class="mt-4 p-4 rounded-lg" style="display: none;"></div>
                    </div>
                </div>

                <!-- Like Test -->
                <div class="bg-white p-6 rounded-lg shadow-lg">
                    <h3 class="text-xl font-bold mb-4">â¤ï¸ Manuel BeÄŸeni Testi</h3>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Post ID:</label>
                            <input type="number" id="likePostId" class="w-full p-3 border border-gray-300 rounded-lg" 
                                   placeholder="888888" value="888888">
                        </div>
                        
                        <div class="flex space-x-2">
                            <button onclick="testLike()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 flex-1">
                                â¤ï¸ BeÄŸeni Toggle
                            </button>
                            <button onclick="checkLikeStatus()" class="bg-gray-500 text-white px-4 py-2 rounded-lg hover:bg-gray-600">
                                ğŸ“Š Durum
                            </button>
                        </div>
                        
                        <div id="likeResult" class="mt-4 p-4 rounded-lg" style="display: none;"></div>
                        
                        <div id="likeStatus" class="mt-4 p-4 bg-gray-100 rounded-lg">
                            <div class="flex justify-between items-center">
                                <span class="font-medium">BeÄŸeni Durumu:</span>
                                <span id="likeStatusText" class="text-gray-500">Bilinmiyor</span>
                            </div>
                            <div class="flex justify-between items-center mt-2">
                                <span class="font-medium">Toplam BeÄŸeni:</span>
                                <span id="likeCountText" class="text-blue-600 font-bold">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Flood Test Area -->
            <div class="bg-white p-6 rounded-lg shadow-lg mt-8">
                <h3 class="text-xl font-bold mb-4">ğŸŒŠ Spam/Flood Test AlanÄ±</h3>
                <p class="text-gray-600 mb-4">HÄ±zlÄ± ardÄ±ÅŸÄ±k iÅŸlemlerle spam kontrolÃ¼nÃ¼ test edin:</p>
                
                <div class="flex space-x-4">
                    <button onclick="floodTestComments()" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600">
                        ğŸ’¬ 10 HÄ±zlÄ± Yorum
                    </button>
                    <button onclick="floodTestLikes()" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600">
                        â¤ï¸ 20 HÄ±zlÄ± BeÄŸeni
                    </button>
                    <button onclick="duplicateCommentTest()" class="bg-yellow-500 text-white px-6 py-2 rounded-lg hover:bg-yellow-600">
                        ğŸ”„ AynÄ± Yorum x5
                    </button>
                </div>
                
                <div id="floodResult" class="mt-4 p-4 rounded-lg" style="display: none;"></div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="js/data.js"></script>
    <script src="js/interaction-security-test.js"></script>
    
    <script>
        // Console override
        const originalLog = console.log;
        let testOutput = '';
        
        function runTests() {
            const resultsDiv = document.getElementById('testResults');
            const outputDiv = document.getElementById('testOutput');
            
            testOutput = '';
            
            console.log = function(...args) {
                const message = args.join(' ');
                testOutput += message + '\n';
                outputDiv.innerHTML = testOutput.replace(/\n/g, '<br>');
                originalLog.apply(console, args);
            };
            
            resultsDiv.style.display = 'block';
            outputDiv.innerHTML = 'Testler baÅŸlatÄ±lÄ±yor...<br>';
            
            setTimeout(() => {
                runInteractionSecurityTests();
                setTimeout(() => {
                    console.log = originalLog;
                }, 1000);
            }, 100);
        }
        
        function createTestEnvironment() {
            if (!localStorage.getItem('paslios_currentUser')) {
                const testUser = {
                    id: 999999,
                    name: 'Test User',
                    email: 'test@test.com',
                    avatar: '/images/default-avatar.png'
                };
                localStorage.setItem('paslios_currentUser', JSON.stringify(testUser));
            }
            
            const pasliosData = new PasliosData();
            const posts = pasliosData.getData('posts');
            const testPostExists = posts.find(p => p.id === 888888);
            
            if (!testPostExists) {
                const testPost = {
                    id: 888888,
                    authorId: 777777, // FarklÄ± kullanÄ±cÄ± ID
                    authorName: 'Other User',
                    content: 'Test gÃ¶nderisi',
                    type: 'text',
                    timestamp: new Date().toISOString(),
                    likedBy: [],
                    comments: []
                };
                posts.unshift(testPost);
                pasliosData.setData('posts', posts);
            }
        }
        
        function testComment() {
            createTestEnvironment();
            
            const postId = parseInt(document.getElementById('commentPostId').value);
            const text = document.getElementById('commentText').value;
            const resultDiv = document.getElementById('commentResult');
            
            const result = API.addComment(postId, { text: text });
            
            resultDiv.style.display = 'block';
            if (result.success) {
                resultDiv.className = 'mt-4 p-4 rounded-lg bg-green-100 border border-green-400';
                resultDiv.innerHTML = `
                    <strong>âœ… Yorum BaÅŸarÄ±yla Eklendi!</strong><br>
                    <strong>ID:</strong> ${result.comment.id}<br>
                    <strong>Ä°Ã§erik:</strong> ${result.comment.content}<br>
                    <strong>Zaman:</strong> ${result.comment.timestamp}
                `;
            } else {
                resultDiv.className = 'mt-4 p-4 rounded-lg bg-red-100 border border-red-400';
                resultDiv.innerHTML = `
                    <strong>âŒ Yorum Eklenemedi!</strong><br>
                    <strong>Hata:</strong> ${result.message}
                `;
            }
        }
        
        function testLike() {
            createTestEnvironment();
            
            const postId = parseInt(document.getElementById('likePostId').value);
            const result = API.toggleLike(postId);
            const resultDiv = document.getElementById('likeResult');
            
            resultDiv.style.display = 'block';
            if (result.success) {
                resultDiv.className = 'mt-4 p-4 rounded-lg bg-green-100 border border-green-400';
                resultDiv.innerHTML = `
                    <strong>âœ… ${result.message}</strong><br>
                    <strong>BeÄŸeni Durumu:</strong> ${result.isLiked ? 'BeÄŸenildi' : 'BeÄŸeni KaldÄ±rÄ±ldÄ±'}<br>
                    <strong>Toplam BeÄŸeni:</strong> ${result.likeCount}
                `;
                updateLikeStatus();
            } else {
                resultDiv.className = 'mt-4 p-4 rounded-lg bg-red-100 border border-red-400';
                resultDiv.innerHTML = `
                    <strong>âŒ Ä°ÅŸlem BaÅŸarÄ±sÄ±z!</strong><br>
                    <strong>Hata:</strong> ${result.message}
                `;
            }
        }
        
        function checkLikeStatus() {
            createTestEnvironment();
            updateLikeStatus();
        }
        
        function updateLikeStatus() {
            const postId = parseInt(document.getElementById('likePostId').value);
            const status = API.getLikeStatus(postId);
            
            document.getElementById('likeStatusText').textContent = status.isLiked ? 'â¤ï¸ BeÄŸenildi' : 'ğŸ¤ BeÄŸenilmedi';
            document.getElementById('likeCountText').textContent = status.likeCount;
        }
        
        function loadXSSComment() {
            document.getElementById('commentText').value = `<script>alert("XSS Attack!")</script>`;
        }
        
        function floodTestComments() {
            createTestEnvironment();
            const resultDiv = document.getElementById('floodResult');
            const postId = 888888;
            
            let successCount = 0;
            let blockedCount = 0;
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'mt-4 p-4 rounded-lg bg-blue-100 border border-blue-400';
            resultDiv.innerHTML = 'Flood test baÅŸlatÄ±lÄ±yor...';
            
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const result = API.addComment(postId, { text: `Flood test yorumu ${i + 1}` });
                    if (result.success) successCount++;
                    else blockedCount++;
                    
                    if (i === 9) {
                        resultDiv.innerHTML = `
                            <strong>ğŸŒŠ Flood Test TamamlandÄ±</strong><br>
                            <strong>BaÅŸarÄ±lÄ± Yorumlar:</strong> ${successCount}<br>
                            <strong>Engellenen Yorumlar:</strong> ${blockedCount}<br>
                            <strong>SonuÃ§:</strong> ${blockedCount > 5 ? 'âœ… Flood korumasÄ± Ã§alÄ±ÅŸÄ±yor' : 'âŒ Flood korumasÄ± yetersiz'}
                        `;
                    }
                }, i * 100);
            }
        }
        
        function floodTestLikes() {
            createTestEnvironment();
            const resultDiv = document.getElementById('floodResult');
            const postId = 888888;
            
            let operations = 0;
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'mt-4 p-4 rounded-lg bg-blue-100 border border-blue-400';
            resultDiv.innerHTML = 'Like flood test baÅŸlatÄ±lÄ±yor...';
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    API.toggleLike(postId);
                    operations++;
                    
                    if (i === 19) {
                        const finalStatus = API.getLikeStatus(postId);
                        resultDiv.innerHTML = `
                            <strong>â¤ï¸ Like Flood Test TamamlandÄ±</strong><br>
                            <strong>Toplam Ä°ÅŸlem:</strong> ${operations}<br>
                            <strong>Final Durum:</strong> ${finalStatus.isLiked ? 'BeÄŸenildi' : 'BeÄŸenilmedi'}<br>
                            <strong>Like Count:</strong> ${finalStatus.likeCount}<br>
                            <strong>SonuÃ§:</strong> ${finalStatus.likeCount <= 1 ? 'âœ… Toggle sistemi Ã§alÄ±ÅŸÄ±yor' : 'âŒ Duplicate like problemi'}
                        `;
                    }
                }, i * 50);
            }
        }
        
        function duplicateCommentTest() {
            createTestEnvironment();
            const resultDiv = document.getElementById('floodResult');
            const postId = 888888;
            const duplicateText = 'Bu tekrarlanan test yorumudur';
            
            let successCount = 0;
            let blockedCount = 0;
            
            resultDiv.style.display = 'block';
            resultDiv.className = 'mt-4 p-4 rounded-lg bg-blue-100 border border-blue-400';
            resultDiv.innerHTML = 'Duplicate comment test baÅŸlatÄ±lÄ±yor...';
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const result = API.addComment(postId, { text: duplicateText });
                    if (result.success) successCount++;
                    else blockedCount++;
                    
                    if (i === 4) {
                        resultDiv.innerHTML = `
                            <strong>ğŸ”„ Duplicate Comment Test TamamlandÄ±</strong><br>
                            <strong>BaÅŸarÄ±lÄ± Yorumlar:</strong> ${successCount}<br>
                            <strong>Engellenen Yorumlar:</strong> ${blockedCount}<br>
                            <strong>SonuÃ§:</strong> ${successCount === 1 && blockedCount === 4 ? 'âœ… Duplicate engelleme Ã§alÄ±ÅŸÄ±yor' : 'âŒ Duplicate engelleme problemi'}
                        `;
                    }
                }, i * 200);
            }
        }
        
        function testCommentAPI() {
            createTestEnvironment();
            
            console.log('ğŸ”Œ Comment API Test BaÅŸlatÄ±lÄ±yor...');
            
            // API simulation test
            const testCases = [
                { postId: 888888, text: 'Normal yorum testi' },
                { postId: 888888, text: '' },
                { postId: 999999, text: 'GeÃ§ersiz post ID' },
                { postId: 888888, text: '<script>alert("XSS")</script>' }
            ];
            
            testCases.forEach((testCase, index) => {
                setTimeout(() => {
                    const result = API.addComment(testCase.postId, { text: testCase.text });
                    console.log(`Test ${index + 1}: ${result.success ? 'âœ… BAÅARILI' : 'âŒ BAÅARISIZ'} - ${result.message || 'OK'}`);
                }, index * 100);
            });
        }
        
        function testLikeAPI() {
            createTestEnvironment();
            
            console.log('ğŸ”Œ Like API Test BaÅŸlatÄ±lÄ±yor...');
            
            const testPostId = 888888;
            
            // Ä°lk beÄŸeni
            setTimeout(() => {
                const result1 = API.toggleLike(testPostId);
                console.log(`BeÄŸeni Ekleme: ${result1.success ? 'âœ… BAÅARILI' : 'âŒ BAÅARISIZ'} - ${result1.message}`);
                
                // Durum kontrolÃ¼
                const status1 = API.getLikeStatus(testPostId);
                console.log(`Durum KontrolÃ¼: BeÄŸenildi: ${status1.isLiked}, Count: ${status1.likeCount}`);
                
                // BeÄŸeniyi kaldÄ±rma
                setTimeout(() => {
                    const result2 = API.toggleLike(testPostId);
                    console.log(`BeÄŸeni KaldÄ±rma: ${result2.success ? 'âœ… BAÅARILI' : 'âŒ BAÅARISIZ'} - ${result2.message}`);
                    
                    const status2 = API.getLikeStatus(testPostId);
                    console.log(`Final Durum: BeÄŸenildi: ${status2.isLiked}, Count: ${status2.likeCount}`);
                }, 100);
            }, 100);
        }
        
        // Sayfa yÃ¼klendiÄŸinde
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ”’ Post interaksiyon gÃ¼venlik test sistemi hazÄ±r!');
            updateLikeStatus();
        });
    </script>
</body>
</html>