// Paslios Data Management System
// LocalStorage tabanlƒ± geli≈ümi≈ü veri y√∂netimi

class PasliosData {
  constructor() {
    this.initializeDatabase();
  }

  // Veritabanƒ±nƒ± ba≈ülat
  initializeDatabase() {
    // Kullanƒ±cƒ± verileri - Ger√ßek kullanƒ±cƒ± profilleri
    if (!localStorage.getItem('paslios_users')) {
      const realUsers = [
        {
          id: 1,
          name: 'Ahmet Yƒ±lmaz',
          email: 'ahmet.yilmaz@paslios.com',
          phone: '0532 555 01 23',
          position: 'Forvet',
          rating: 4.7,
          avatar: null, // UI-Avatars kullanƒ±lacak
          bio: 'Yazƒ±lƒ±m m√ºhendisi ve futbol tutkunu. 10 yƒ±ldƒ±r halƒ±saha futbolu oynuyor.',
          location: 'Ankara/√áankaya',
          matchesPlayed: 127,
          matchesWon: 89,
          goals: 67,
          assists: 34,
          cleanSheets: 0,
          mvpAwards: 12,
          joinDate: '2023-08-15',
          lastLoginDate: new Date().toISOString(),
          isCurrentUser: true,
          teamId: 1,
          friendIds: [2, 3, 4, 5],
          stats: {
            totalPoints: 1247,
            weeklyPoints: 85,
            monthlyPoints: 324,
            level: 15,
            xp: 2456,
            badgeIds: [1, 2, 3, 5, 8]
          }
        },
        {
          id: 2,
          name: 'Mehmet Kaya',
          email: 'mehmet.kaya@gmail.com',
          phone: '0533 444 67 89',
          position: 'Orta Saha',
          rating: 4.5,
          avatar: null,
          bio: 'Makine m√ºhendisi. Pas verme konusunda uzman.',
          location: 'Ankara/Ke√ßi√∂ren',
          matchesPlayed: 98,
          matchesWon: 61,
          goals: 23,
          assists: 52,
          cleanSheets: 0,
          mvpAwards: 8,
          joinDate: '2023-09-22',
          lastLoginDate: '2024-12-20T15:30:00.000Z',
          teamId: 1,
          friendIds: [1, 3, 6],
          stats: {
            totalPoints: 987,
            weeklyPoints: 72,
            monthlyPoints: 289,
            level: 12,
            xp: 1876,
            badgeIds: [1, 3, 4]
          }
        },
        {
          id: 3,
          name: 'Ali Demir',
          email: 'ali.demir@hotmail.com',
          phone: '0534 777 12 34',
          position: 'Defans',
          rating: 4.8,
          avatar: null,
          bio: 'G√ºvenilir defans oyuncusu. Temiz oyun tarzƒ±yla tanƒ±nƒ±r.',
          location: 'Ankara/Mamak',
          matchesPlayed: 156,
          matchesWon: 98,
          goals: 12,
          assists: 18,
          cleanSheets: 47,
          mvpAwards: 15,
          joinDate: '2023-07-10',
          lastLoginDate: '2024-12-21T09:15:00.000Z',
          teamId: 1,
          friendIds: [1, 2, 4, 7],
          stats: {
            totalPoints: 1456,
            weeklyPoints: 96,
            monthlyPoints: 378,
            level: 18,
            xp: 3124,
            badgeIds: [1, 2, 3, 6, 7, 9]
          }
        },
        {
          id: 4,
          name: 'Burak √ñzkan',
          email: 'burak.ozkan@yahoo.com',
          phone: '0535 888 99 00',
          position: 'Kaleci',
          rating: 4.6,
          avatar: null,
          bio: 'Deneyimli kaleci. Refleksleri √ßok iyi.',
          location: 'Ankara/Etimesgut',
          matchesPlayed: 89,
          matchesWon: 67,
          goals: 0,
          assists: 3,
          cleanSheets: 34,
          mvpAwards: 11,
          joinDate: '2023-10-05',
          lastLoginDate: '2024-12-21T14:20:00.000Z',
          teamId: 2,
          friendIds: [1, 3, 5],
          stats: {
            totalPoints: 1123,
            weeklyPoints: 78,
            monthlyPoints: 312,
            level: 14,
            xp: 2234,
            badgeIds: [1, 4, 5, 8]
          }
        },
        {
          id: 5,
          name: 'Emre Aydƒ±n',
          email: 'emre.aydin@gmail.com',
          phone: '0536 123 45 67',
          position: 'Kanat',
          rating: 4.4,
          avatar: null,
          bio: 'Hƒ±zlƒ± kanat oyuncusu. Dripling konusunda yetenekli.',
          location: 'Ankara/Yenimahalle',
          matchesPlayed: 72,
          matchesWon: 45,
          goals: 31,
          assists: 28,
          cleanSheets: 0,
          mvpAwards: 6,
          joinDate: '2023-11-18',
          lastLoginDate: '2024-12-20T18:45:00.000Z',
          teamId: null,
          friendIds: [1, 4, 6],
          stats: {
            totalPoints: 867,
            weeklyPoints: 64,
            monthlyPoints: 256,
            level: 11,
            xp: 1675,
            badgeIds: [1, 2, 4]
          }
        },
        {
          id: 6,
          name: 'Cem Yƒ±ldƒ±z',
          email: 'cem.yildiz@outlook.com',
          phone: '0537 456 78 90',
          position: 'Orta Saha',
          rating: 4.3,
          avatar: null,
          bio: 'Gen√ß ve hƒ±rslƒ± oyuncu. S√ºrekli geli≈üim halinde.',
          location: 'Ankara/Altƒ±ndaƒü',
          matchesPlayed: 43,
          matchesWon: 24,
          goals: 8,
          assists: 14,
          cleanSheets: 0,
          mvpAwards: 2,
          joinDate: '2024-01-12',
          lastLoginDate: '2024-12-21T11:30:00.000Z',
          teamId: null,
          friendIds: [2, 5],
          stats: {
            totalPoints: 534,
            weeklyPoints: 45,
            monthlyPoints: 187,
            level: 7,
            xp: 892,
            badgeIds: [1]
          }
        }
      ];
      this.setData('users', realUsers);
    }

    // Takƒ±m verileri - Ger√ßek takƒ±m bilgileri
    if (!localStorage.getItem('paslios_teams')) {
      const realTeams = [
        {
          id: 1,
          name: '√áankaya Tigers FC',
          emoji: 'üêÖ',
          color: '#ff6b35',
          privacy: 'public',
          description: '√áankaya b√∂lgesinin en deneyimli halƒ±saha takƒ±mƒ±. 2018\'den beri faaliyet g√∂steriyoruz.',
          foundedDate: '2018-03-15',
          captainId: 1,
          members: [1, 2, 3],
          memberCount: 3,
          location: 'Ankara/√áankaya',
          homeVenue: '√áankaya Halƒ±saha Complex',
          matchesPlayed: 89,
          wins: 58,
          draws: 18,
          losses: 13,
          points: 192,
          goalsFor: 234,
          goalsAgainst: 127,
          trophies: 5,
          achievements: [
            '√áankaya Ligi ≈ûampiyonu 2023',
            'En Fair Play Takƒ±mƒ± 2024',
            'B√∂lge Kupasƒ± Finalisti 2023'
          ],
          createdAt: '2018-03-15T00:00:00.000Z',
          updatedAt: new Date().toISOString()
        },
        {
          id: 2,
          name: 'Ke√ßi√∂ren Wolves',
          emoji: 'üê∫',
          color: '#2d3748',
          privacy: 'invite',
          description: 'Gen√ß ve dinamik oyuncu kadrosuyla dikkat √ßeken takƒ±m.',
          foundedDate: '2020-09-08',
          captainId: 4,
          members: [4],
          memberCount: 1,
          location: 'Ankara/Ke√ßi√∂ren',
          homeVenue: 'Ke√ßi√∂ren Sports Center',
          matchesPlayed: 67,
          wins: 41,
          draws: 14,
          losses: 12,
          points: 137,
          goalsFor: 178,
          goalsAgainst: 89,
          trophies: 2,
          achievements: [
            'Ke√ßi√∂ren Kupasƒ± ≈ûampiyonu 2024',
            'En Gen√ß Takƒ±m √ñd√ºl√º 2023'
          ],
          createdAt: '2020-09-08T00:00:00.000Z',
          updatedAt: new Date().toISOString()
        }
      ];
      this.setData('teams', realTeams);
    }

    // Ma√ß verileri - Ger√ßek ma√ß bilgileri
    if (!localStorage.getItem('paslios_matches')) {
      const today = new Date();
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      const nextWeek = new Date(today);
      nextWeek.setDate(nextWeek.getDate() + 7);

      const realMatches = [
        {
          id: 1,
          type: 'individual',
          title: 'Ak≈üam Halƒ±saha Ma√ßƒ±',
          date: today.toISOString().split('T')[0],
          time: '19:30',
          venue: '√áankaya Halƒ±saha Complex',
          location: 'Ankara/√áankaya',
          players: [1, 2, 3, 5],
          maxPlayers: 10,
          currentPlayers: 4,
          price: 25,
          status: 'waiting',
          organizer: 'Ahmet Yƒ±lmaz',
          organizerId: 1,
          description: 'Hafta sonundan √∂nce g√ºzel bir ma√ß yapalƒ±m!',
          skillLevel: 'intermediate',
          duration: 90,
          pitchType: 'halƒ±saha',
          createdAt: new Date().toISOString()
        },
        {
          id: 2,
          type: 'individual',
          title: 'Pazartesi Ak≈üam Futbolu',
          date: tomorrow.toISOString().split('T')[0],
          time: '20:00',
          venue: 'Ke√ßi√∂ren Sports Center',
          location: 'Ankara/Ke√ßi√∂ren',
          players: [2, 4, 6],
          maxPlayers: 12,
          currentPlayers: 3,
          price: 30,
          status: 'waiting',
          organizer: 'Mehmet Kaya',
          organizerId: 2,
          description: 'Haftaya iyi ba≈ülayalƒ±m. T√ºm seviyelerden oyuncular davetli.',
          skillLevel: 'beginner',
          duration: 90,
          pitchType: '√ßim',
          createdAt: '2024-12-20T14:30:00.000Z'
        },
        {
          id: 3,
          type: 'team',
          title: '√áankaya Tigers vs Ke√ßi√∂ren Wolves',
          date: nextWeek.toISOString().split('T')[0],
          time: '15:00',
          venue: 'Ankara B√ºy√ºk≈üehir Stadyumu',
          location: 'Ankara/Merkez',
          homeTeam: 1,
          awayTeam: 2,
          maxPlayers: 22,
          currentPlayers: 22,
          price: 0,
          status: 'confirmed',
          organizer: '√áankaya Tigers FC',
          organizerId: 1,
          description: 'Sezonun en b√ºy√ºk derbisi! ƒ∞ki g√º√ßl√º takƒ±m kar≈üƒ± kar≈üƒ±ya.',
          skillLevel: 'advanced',
          duration: 90,
          pitchType: '√ßim',
          isCompetitive: true,
          createdAt: '2024-12-15T10:00:00.000Z'
        },
        {
          id: 4,
          type: 'individual',
          title: '√ñƒüle Arasƒ± Hƒ±zlƒ± Ma√ß',
          date: today.toISOString().split('T')[0],
          time: '12:30',
          venue: 'Tunalƒ± Sports Club',
          location: 'Ankara/√áankaya',
          players: [1, 3],
          maxPlayers: 8,
          currentPlayers: 2,
          price: 20,
          status: 'waiting',
          organizer: 'Ali Demir',
          organizerId: 3,
          description: '√ñƒüle molasƒ±nda kƒ±sa bir ma√ß. 45 dakika s√ºrecek.',
          skillLevel: 'intermediate',
          duration: 45,
          pitchType: 'halƒ±saha',
          createdAt: '2024-12-21T08:00:00.000Z'
        }
      ];
      this.setData('matches', realMatches);
    }

    // Mesaj verileri - Ger√ßek mesajla≈üma sistemi
    if (!localStorage.getItem('paslios_messages')) {
      const defaultMessages = [
        {
          id: 1,
          senderId: 2,
          receiverId: 1,
          message: 'Selam! Bu ak≈üam ma√ßa gelecek misin?',
          timestamp: Date.now() - 3600000,
          read: false
        },
        {
          id: 2,
          senderId: 1,
          receiverId: 2,
          message: 'Evet kesinlikle! Saat ka√ßta ba≈ülƒ±yor?',
          timestamp: Date.now() - 3480000,
          read: true
        }
      ];
      this.setData('messages', defaultMessages);
    }

    // Bildirim verileri
    if (!localStorage.getItem('paslios_notifications')) {
      const defaultNotifications = [
        {
          id: 1,
          type: 'match_invite',
          title: 'Ma√ß Daveti',
          message: 'Mehmet Kaya sizi yarƒ±nki ma√ßa davet etti',
          timestamp: Date.now() - 1800000,
          read: false,
          actionUrl: 'matches.html'
        },
        {
          id: 2,
          type: 'team_update',
          title: 'Takƒ±m G√ºncellemesi',
          message: '√áankaya Tigers takƒ±mƒ±nda yeni bir √ºye var',
          timestamp: Date.now() - 7200000,
          read: false,
          actionUrl: 'team.html'
        }
      ];
      this.setData('notifications', defaultNotifications);
    }

    // Sosyal g√∂nderi verileri
    if (!localStorage.getItem('paslios_posts')) {
      const defaultPosts = [
        {
          id: 1,
          authorId: 2,
          authorName: 'Mehmet Kaya',
          authorAvatar: 'MK',
          content: 'Bug√ºnk√º ma√ßta harika bir performans sergiledik! Takƒ±m arkada≈ülarƒ±m √ßok iyiydi. Bu tempo devam ederse ≈üampiyonluk bizim! üèÜ‚öΩ',
          timestamp: Date.now() - 7200000, // 2 saat √∂nce
          likes: 24,
          comments: 8,
          shares: 3,
          likedBy: [1, 3, 4, 5],
          type: 'match_result'
        },
        {
          id: 2,
          authorId: 3,
          authorName: 'Emre Demir',
          authorAvatar: 'ED',
          content: 'Yeni ayakkabƒ±larƒ±m geldi! Nike Mercurial Vapor 15. Yarƒ±n sahada test edeceƒüim. Kim durmak ister? üòè‚öΩ',
          timestamp: Date.now() - 14400000, // 4 saat √∂nce
          likes: 18,
          comments: 12,
          shares: 2,
          likedBy: [1, 2, 6],
          type: 'equipment'
        },
        {
          id: 3,
          authorId: 4,
          authorName: 'Can √ñzkan',
          authorAvatar: 'C√ñ',
          content: 'Ge√ßen hafta 5 gol attƒ±m! Bu sezonki en iyi performansƒ±mdƒ±. Antrenmanlar ger√ßekten i≈üe yarƒ±yor üí™üî•',
          timestamp: Date.now() - 86400000, // 1 g√ºn √∂nce
          likes: 32,
          comments: 6,
          shares: 5,
          likedBy: [1, 2, 3, 7, 8],
          type: 'achievement'
        },
        {
          id: 4,
          authorId: 5,
          authorName: 'Burak Tun√ß',
          authorAvatar: 'BT',
          content: 'Yeni saha ke≈üfettim! √áimenli ve √ßok g√ºzel. Bu hafta sonu orada ma√ß yapacaƒüƒ±z. Kimse gelecek? üå±‚öΩ',
          timestamp: Date.now() - 172800000, // 2 g√ºn √∂nce
          likes: 21,
          comments: 15,
          shares: 4,
          likedBy: [1, 2, 9, 10],
          type: 'venue_discovery'
        }
      ];
      this.setData('posts', defaultPosts);
    }

    // Rezervasyon verileri
    if (!localStorage.getItem('paslios_bookings')) {
      const defaultBookings = [
        {
          id: 1,
          userId: 1,
          userName: 'Ahmet Yƒ±lmaz',
          userPhone: '0555 123 45 67',
          venueName: 'Spor A Halƒ±saha',
          venuePrice: 150,
          date: new Date().toISOString().split('T')[0],
          time: '19:00',
          playerCount: 10,
          totalPrice: 150,
          status: 'confirmed',
          bookingDate: Date.now() - 86400000, // 1 g√ºn √∂nce
          paymentMethod: 'credit_card',
          notes: '√áankaya b√∂lgesindeki arkada≈ülarla ma√ß'
        }
      ];
      this.setData('bookings', defaultBookings);
    }

    // Ayarlar
    if (!localStorage.getItem('paslios_settings')) {
      const defaultSettings = {
        theme: 'light',
        language: 'tr',
        notifications: {
          push: true,
          matchInvites: true,
          weeklyReport: true,
          teamUpdates: true
        },
        privacy: {
          profileVisible: true,
          contactVisible: true,
          statsVisible: true
        }
      };
      this.setData('settings', defaultSettings);
    }
  }

  // Veri getir
  getData(key) {
    const data = localStorage.getItem(`paslios_${key}`);
    return data ? JSON.parse(data) : null;
  }

  // Veri kaydet
  setData(key, data) {
    localStorage.setItem(`paslios_${key}`, JSON.stringify(data));
  }

  // Veri g√ºncelle
  updateData(key, id, updatedData) {
    const data = this.getData(key);
    if (data && Array.isArray(data)) {
      const index = data.findIndex(item => item.id === id);
      if (index !== -1) {
        data[index] = { ...data[index], ...updatedData };
        this.setData(key, data);
        return true;
      }
    }
    return false;
  }

  // Veri ekle
  addData(key, newData) {
    const data = this.getData(key) || [];
    const newId = Math.max(...data.map(item => item.id || 0)) + 1;
    const dataWithId = { ...newData, id: newId };
    data.push(dataWithId);
    this.setData(key, data);
    return dataWithId;
  }

  // Veri sil
  deleteData(key, id) {
    const data = this.getData(key);
    if (data && Array.isArray(data)) {
      const filteredData = data.filter(item => item.id !== id);
      this.setData(key, filteredData);
      return true;
    }
    return false;
  }

  // Kullanƒ±cƒ± y√∂netimi
  getCurrentUser() {
    const users = this.getData('users');
    return users ? users.find(user => user.isCurrentUser) : null;
  }

  updateCurrentUser(userData) {
    const currentUser = this.getCurrentUser();
    if (currentUser) {
      return this.updateData('users', currentUser.id, userData);
    }
    return false;
  }

  // Oturum y√∂netimi
  login(email, password) {
    const users = this.getData('users');
    const user = users.find(u => u.email === email && u.password === password);
    
    if (user) {
      // T√ºm kullanƒ±cƒ±larƒ± isCurrentUser: false yap
      users.forEach(u => u.isCurrentUser = false);
      // Giri≈ü yapan kullanƒ±cƒ±yƒ± i≈üaretle
      user.isCurrentUser = true;
      this.setData('users', users);
      
      // Oturum bilgisini kaydet
      this.setData('session', {
        isLoggedIn: true,
        userId: user.id,
        loginTime: Date.now()
      });
      
      return { success: true, user };
    }
    
    return { success: false, message: 'Kullanƒ±cƒ± bulunamadƒ±' };
  }

  register(userData) {
    const users = this.getData('users');
    
    // Email kontrol√º
    const existingUser = users.find(u => u.email === userData.email);
    if (existingUser) {
      return { success: false, message: 'Bu email zaten kayƒ±tlƒ±' };
    }

    // Yeni kullanƒ±cƒ± olu≈ütur
    const newUser = {
      ...userData,
      rating: 0,
      avatar: userData.name.split(' ').map(n => n[0]).join('').toUpperCase(),
      matchesPlayed: 0,
      goals: 0,
      assists: 0,
      isCurrentUser: true,
      joinDate: new Date().toISOString().split('T')[0]
    };

    // Diƒüer kullanƒ±cƒ±larƒ± isCurrentUser: false yap
    users.forEach(u => u.isCurrentUser = false);
    
    const addedUser = this.addData('users', newUser);
    
    // Oturum bilgisini kaydet
    this.setData('session', {
      isLoggedIn: true,
      userId: addedUser.id,
      loginTime: Date.now()
    });
    
    return { success: true, user: addedUser };
  }

  logout() {
    const users = this.getData('users');
    users.forEach(u => u.isCurrentUser = false);
    this.setData('users', users);
    
    this.setData('session', {
      isLoggedIn: false,
      userId: null,
      loginTime: null
    });
  }

  isLoggedIn() {
    const session = this.getData('session');
    return session && session.isLoggedIn;
  }

  // Yardƒ±mcƒ± fonksiyonlar
  searchUsers(query) {
    const users = this.getData('users');
    return users.filter(user => 
      user.name.toLowerCase().includes(query.toLowerCase()) ||
      user.position.toLowerCase().includes(query.toLowerCase()) ||
      user.location.toLowerCase().includes(query.toLowerCase())
    );
  }

  searchTeams(query) {
    const teams = this.getData('teams');
    return teams.filter(team => 
      team.name.toLowerCase().includes(query.toLowerCase()) ||
      team.description.toLowerCase().includes(query.toLowerCase())
    );
  }

  getUpcomingMatches() {
    const matches = this.getData('matches');
    const now = new Date();
    return matches.filter(match => {
      const matchDate = new Date(`${match.date} ${match.time}`);
      return matchDate > now;
    }).sort((a, b) => new Date(`${a.date} ${a.time}`) - new Date(`${b.date} ${b.time}`));
  }

  getUserStats(userId) {
    const user = this.getData('users').find(u => u.id === userId);
    if (!user) return null;

    return {
      matchesPlayed: user.matchesPlayed || 0,
      goals: user.goals || 0,
      assists: user.assists || 0,
      rating: user.rating || 0,
      winRate: user.matchesPlayed > 0 ? ((user.wins || 0) / user.matchesPlayed * 100).toFixed(1) : 0
    };
  }

  // Sosyal g√∂nderi y√∂netimi
  getPosts(limit = 10) {
    const posts = this.getData('posts') || [];
    return posts
      .sort((a, b) => b.timestamp - a.timestamp)
      .slice(0, limit);
  }

  createPost(content, type = 'general') {
    const currentUser = this.getCurrentUser();
    if (!currentUser) return { success: false, message: 'Giri≈ü yapmalƒ±sƒ±nƒ±z' };

    const newPost = {
      authorId: currentUser.id,
      authorName: currentUser.name,
      authorAvatar: currentUser.avatar,
      content: content,
      timestamp: Date.now(),
      likes: 0,
      comments: 0,
      shares: 0,
      likedBy: [],
      type: type
    };

    const addedPost = this.addData('posts', newPost);
    return { success: true, post: addedPost };
  }

  likePost(postId) {
    const currentUser = this.getCurrentUser();
    if (!currentUser) return { success: false, message: 'Giri≈ü yapmalƒ±sƒ±nƒ±z' };

    const posts = this.getData('posts');
    const postIndex = posts.findIndex(p => p.id === postId);
    
    if (postIndex === -1) return { success: false, message: 'G√∂nderi bulunamadƒ±' };

    const post = posts[postIndex];
    const userLikedIndex = post.likedBy.indexOf(currentUser.id);

    if (userLikedIndex === -1) {
      // Beƒüeni ekle
      post.likedBy.push(currentUser.id);
      post.likes++;
    } else {
      // Beƒüeniyi kaldƒ±r
      post.likedBy.splice(userLikedIndex, 1);
      post.likes--;
    }

    this.setData('posts', posts);
    return { success: true, liked: userLikedIndex === -1, likes: post.likes };
  }

  sharePost(postId) {
    const posts = this.getData('posts');
    const postIndex = posts.findIndex(p => p.id === postId);
    
    if (postIndex === -1) return { success: false, message: 'G√∂nderi bulunamadƒ±' };

    posts[postIndex].shares++;
    this.setData('posts', posts);
    return { success: true, shares: posts[postIndex].shares };
  }

  addComment(postId, comment) {
    const currentUser = this.getCurrentUser();
    if (!currentUser) return { success: false, message: 'Giri≈ü yapmalƒ±sƒ±nƒ±z' };

    const posts = this.getData('posts');
    const postIndex = posts.findIndex(p => p.id === postId);
    
    if (postIndex === -1) return { success: false, message: 'G√∂nderi bulunamadƒ±' };

    posts[postIndex].comments++;
    this.setData('posts', posts);

    // Yorumu ayrƒ± olarak da saklayabiliriz (gelecekte detaylƒ± yorum sistemi i√ßin)
    return { success: true, comments: posts[postIndex].comments };
  }

  formatTimeAgo(timestamp) {
    const now = Date.now();
    const diffInSeconds = Math.floor((now - timestamp) / 1000);
    
    if (diffInSeconds < 60) return 'Az √∂nce';
    if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)} dakika √∂nce`;
    if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)} saat √∂nce`;
    if (diffInSeconds < 2592000) return `${Math.floor(diffInSeconds / 86400)} g√ºn √∂nce`;
    
    return new Date(timestamp).toLocaleDateString('tr-TR');
  }

  // Rezervasyon y√∂netimi
  getBookings(userId = null) {
    const bookings = this.getData('bookings') || [];
    if (userId) {
      return bookings.filter(booking => booking.userId === userId);
    }
    return bookings;
  }

  createBooking(bookingData) {
    const currentUser = this.getCurrentUser();
    if (!currentUser) return { success: false, message: 'Giri≈ü yapmalƒ±sƒ±nƒ±z' };

    const newBooking = {
      userId: currentUser.id,
      userName: currentUser.name,
      userPhone: currentUser.phone || '',
      venueName: bookingData.venueName,
      venuePrice: bookingData.venuePrice,
      date: bookingData.date,
      time: bookingData.time,
      playerCount: bookingData.playerCount,
      totalPrice: bookingData.totalPrice,
      status: 'confirmed',
      bookingDate: Date.now(),
      paymentMethod: bookingData.paymentMethod || 'credit_card',
      notes: bookingData.notes || ''
    };

    const addedBooking = this.addData('bookings', newBooking);
    return { success: true, booking: addedBooking };
  }

  cancelBooking(bookingId) {
    const currentUser = this.getCurrentUser();
    if (!currentUser) return { success: false, message: 'Giri≈ü yapmalƒ±sƒ±nƒ±z' };

    const bookings = this.getData('bookings');
    const bookingIndex = bookings.findIndex(b => b.id === bookingId && b.userId === currentUser.id);
    
    if (bookingIndex === -1) return { success: false, message: 'Rezervasyon bulunamadƒ±' };

    bookings[bookingIndex].status = 'cancelled';
    this.setData('bookings', bookings);
    return { success: true };
  }

  // Saha ke≈üfedelme fonksiyonlarƒ±
  getVenues() {
    return this.getData('venues') || this.getDefaultVenues();
  }

  getDefaultVenues() {
    const defaultVenues = [
      {
        id: 1,
        name: 'Spor A Halƒ±saha',
        location: '√áankaya, Ankara',
        distance: '1.2 km',
        price: 150,
        rating: 4.8,
        reviewCount: 156,
        type: 'Halƒ± Saha',
        features: ['Du≈ü', 'Soyunma Odasƒ±', 'Otopark', 'Kafe', 'WiFi'],
        availableSlots: ['17:00', '18:00', '19:00', '20:00', '22:00'],
        image: 'üèüÔ∏è'
      },
      {
        id: 2,
        name: 'Champions Halƒ±saha',
        location: 'Ke√ßi√∂ren, Ankara',
        distance: '2.8 km',
        price: 180,
        rating: 4.6,
        reviewCount: 89,
        type: 'Halƒ± Saha',
        features: ['Du≈ü', 'Soyunma Odasƒ±', 'Otopark', 'Trib√ºn'],
        availableSlots: ['16:00', '17:00', '18:00', '19:00', '20:00', '21:00'],
        image: 'üèüÔ∏è'
      },
      {
        id: 3,
        name: 'Elite Football Center',
        location: 'Kƒ±zƒ±lay, Ankara',
        distance: '3.5 km',
        price: 200,
        rating: 4.9,
        reviewCount: 234,
        type: '√áim Saha',
        features: ['Du≈ü', 'Soyunma Odasƒ±', 'Otopark', 'Kafe', 'Klima', 'Ses Sistemi'],
        availableSlots: ['15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00'],
        image: 'üå±'
      }
    ];
    
    this.setData('venues', defaultVenues);
    return defaultVenues;
  }
}

// Global instance olu≈ütur
window.PasliosData = new pasliosData();
